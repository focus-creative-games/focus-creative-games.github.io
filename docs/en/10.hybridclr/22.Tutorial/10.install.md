---
title: Install HybridCLR
date: 2022-05-25 11:50:18
permalink: /hybridclr/install/
categories:
    - HybridCLR
tags:
    -
author:
    name: walon
    link: https://github.com/pirunxi
---

# Install HybridCLR

Here we mainly introduce the installation process. For detailed documentation on the parameters and settings involved in the installation process, please refer to [hybridclr_unity](/en/hybridclr/hybridclr_unity/)

## Preparatory work before installation

- Install 2019.4.40, 2020.3.26, 2021.3.0 or later version. Novices are strongly recommended to use the 2020.3.33 version to familiarize hot update before trying the version of their own projects.The Installer uses the version number in the path to determine the Unity version, so if the version number of hybridclr_unity you installed is <=1.1.6, please make sure that the version number is included in the installation path, such as `d:\Unity2020.3.33`, but 1.1.7 version and later versions have removed this limitation.
- To use il2cpp backend, the il2cpp component must be included when installing Unity. If it is not installed, please install it in UnityHub by yourself.
- Install related development SDK and IDE
    - Under Win, you need to install `visual studio 2019` or later. The `Game Development with C++` component must be selected during installation. If you use the latest version of Visual Studio 2022 which after the release of .net 7, compilation errors will occur, because the Visual Studio 2022 has compatibility issues with il2cpp. Please refer to [Common Errors](/en/hybridclr/common_errors/) encountered xxxx\il2cpp\libil2cpp\utils\Il2CppHashMap.h(71): error C2039: 'hash_compare': is not a member of 'stdext when packaging under Win '` the solution to the problem.
    - Under Mac, you need to install a newer version of xcode, such as `xcode 13.4.1 macos 12.4`. Which is the minimum supported version we haven't carefully verified.
- Install git

## Install the HybridCLR package

Use the `install from git url` method of the package manager to install the hybridclr_unity package.

The main warehouse of hybridclr_unity is at [github](https://github.com/focus-creative-games/hybridclr_unity), Chinese fast mirror warehouse is at [gitee](https://gitee.com/focus-creative-games/ hybridclr_unity).

Now the hybridclr_unity package has multiple branches, the main branch is the development branch, and 1.0 is the latest stable branch.

The team in the development period can choose the main branch, and its url address is `https://gitee.com/focus-creative-games/hybridclr_unity.git`. If you are about to launch or have already launched, please select the 1.0 branch or a specific tag, and its url address is `https://gitee.com/focus-creative-games/hybridclr_unity.git#1.0`
or `https://gitee.com/focus-creative-games/hybridclr_unity.git#{tag}`.

If you are not familiar with installing packages from url, please refer to [install from giturl](https://docs.unity3d.com/Manual/upm-ui-giturl.html).

If you encounter network exceptions that fail to install. You can clone or download `com.focus-creative-games.hybridclr_unity` to local, and then [install from disk](https://docs.unity3d.com/Manual/upm-ui-local.html).

Or a simpler way, after downloading to the local, rename the warehouse folder directory to `com.focus-creative-games.hybridclr_unity`, and copy it directly to the `Packages` directory of your project.

hybridclr_unity also has a warehouse on openupm, but there is a large update delay and poor support for branches. We have abandoned the warehouse on openump and will no longer maintain it.

## Initialization HybridCLR

In order to reduce the size of the package itself, some files need to be copied from the installation directory of Unity Editor. Therefore, after installing the plugin, an additional initialization process is required.

Click the menu `HybridCLR/Installer...` to pop up the installation interface. If there are no errors or warnings on the installation interface, it means that the il2cpp path setting is normal, otherwise you need to manually select the correct il2cpp directory (similar to `C:\Program Files\Unity\Hub\Editor\2020.3.33f1\Editor\Data\il2cpp`)

Fill in the commit id or branch or tag of the hybridclr and il2cpp_plus warehouses you want to install. If the version number of hybridclr is left blank, it means to install the latest version of the main branch of the hybridclr repository.If the version number of il2cpp_plus is left blank, it means to install the latest version of the main branch of the corresponding annual version (such as 2020-main).

**The branch of the hybridclr warehouse must match the branch of the il2cpp_plus warehouse**. If the hybridclr in your project uses the main branch, then il2cpp_plus must also use `{version}-main`, if your hybridclr uses the `1.0` branch, then il2cpp_plus must use the `{version}-1.0` branch.
If you use a version of a tag, please make sure the tag matches the branch it belongs to.

The hybridclr warehouse recommends filling in `1.0`, that is, to install the latest version in the 1.0 branch every time. The il2cpp_plus warehouse recommends filling in `{annual version}-1.0` (such as 2020-1.0), that is, to install the latest version of the `{annual version}-1.0` branch every time. As shown in the picture:

![image](/img/hybridclr/install_version.jpg)

Click the `install` button to complete the installation.

Currently, the installer requires the path of il2cpp to include the version number of Unity (such as `Editor\2020.3.33f1\Editor\Data\il2cpp`). If installer does not include it, will reports an error.

If the installation fails, the most common reason is that git is not installed, or UnityEditor and UnityHub have not been restarted after installing git. If you are sure that git is installed and can be run in cmd, try restarting the computer.

## Unity version related special operations

### Unity 2021

For developers who use `HomologousImageMode::SuperSet` mode for supplementary metadata, they can directly use the original AOT dll, **do not** need to do the following processing.

For developers using the `HomologousImageMode::Consistent` mode, HybridCLR requires a trimmed AOT dll.

For developers using the `HomologousImageMode::Consistent` mode, HybridCLR requires a trimmed AOT dll. However, when Unity 2021 version (not required for 2019 and 2020) packages `iOS platform` (not required for other platforms), Unity Editor does not provide a public interface to copy the cropped AOT dll when the target is iOS. So you must use the modified UnityEditor.CoreModule.dll to overwrite the corresponding files that come with Unity.

The specific operation is to cover `{package directory}/Data~/ModifiedUnityAssemblies/2021.3.x/UnityEditor.CoreModule-{Win,Mac}.dll` with `{Editor installation directory}/Editor/Data/Managed/UnityEngine/UnityEditor.CoreModule .dll`, the specific related directory may vary depending on the operating system or Unity version.

**Due to permission issues, this operation cannot be completed automatically, and you need to manually perform the copy operation.**

The `UnityEditor.CoreModule.dll` of each small version of Unity is different. We currently only provide the 2021.3.1 and 2021.3.6 versions. If you need other versions, please make them by yourself. For more details, please refer to [Modify the Unity Editor Related dll](/en/hybridclr/modify_unity_dll/).

### Unity 2019

We modified the il2cpp tool of 2019 version in order to support Unity 2019. Therefore, there is an additional step in the Installer installation process: copy `{package}/Data~/ModifiedUnityAssemblies/2019.4.40/Unity.IL2CPP.dll` to `{project}/HybridCLRData/LocalIl2CppData/il2cpp/build/deploy/net471 /Unity.IL2CPP.dll`

**Note that this operation is automatically completed when the Installer is installed, no manual operation is required.**

Due to the limited time, we currently only made the `Unity.IL2CPP.dll` file of 2019.4.40 version, and more versions will be added in the future. If you need other versions, please make them by yourself. For more details, please refer to [Modify the Unity Editor Related dll](/en/hybridclr/modify_unity_dll/).

## Installation Principle

This section only introduces the principle, the operation of installing libil2cpp has been completed by the installer, and you need to do nothing in here.

The HybridCLR installation process mainly includes these parts:

- Replace libil2cpp code
- Minor improvements to the Unity Editor

### Replace libil2cpp code

The original libil2cpp code is a static CLR and needs to be replaced with a modified libil2cpp to support hot updates. The modified libil2cpp consists of two parts

- [il2cpp_plus](https://github.com/focus-creative-games/il2cpp_plus)
- [hybridclr](https://github.com/focus-creative-games/hybridclr)


The il2cpp_plus repository is a slightly modified version of the original libil2cpp to support dynamic **register** metadata (changed hundreds of lines of code). This repository is highly comparable to the original libil2cpp code
resemblance. 2019-2021 each has a corresponding main development branch `{version}-main`, and a corresponding release version branch `{version}-x.x`.

Hybridclr is the core code of the interpreter, including metadata loading, code transform (compilation), and code interpretation and execution. All Unity versions share the same set of hybridclr code.

![merge_hybridclr_dir](/img/hybridclr/merge_hybridclr_dir.jpg)

According to the il2cpp_plus branch that matches your Unity version (see [supported_unity_versions](/en/hybridclr/supported_unity_versions/) for details) and hybridclr to produce the final version of libil2cpp, there are two installation methods:

#### Global installation

Directly replace the libil2cpp directory in the Editor installation directory ({editor}/Data/il2cpp/libil2cpp under Win, similar to Mac). The advantage is simplicity, and the disadvantage is that it will affect other projects that do not use hybridclr, and may encounter directory permission problems.

Use global installation when `HybridCLRSettings.useGlobalIl2Cpp=true`, but you still need to manually copy the `{project}/HyridCLRData/LocalIl2CppData-{platform}/il2cpp/libil2cpp` directory to replace the corresponding directory under the editor.

#### Project local installation

Unity allows customizing the location of `il2cpp` using the environment variable `UNITY_IL2CPP_PATH`. Therefore, in the hybridclr_unity package, point the process environment variable `UNITY_IL2CPP_PATH` to `{project}/HyridCLRData/LocalIl2CppData-{platform}/il2cpp`. Copy the il2cpp directory from the Unity Editr installation directory, then replace the `il2cpp/libil2cpp` directory with the modified lil2cpp.

Why do you need to create the upper `LocalIl2CppData-{platform}` directory instead of just creating il2cpp? The actual test found that it is not enough to specify the location of the il2cpp directory. When packaging, Unity implicitly assumed that there is a `MonoBleedingEdge` directory at the same level as il2cpp, so it created the upper-level directory and copied both the il2cpp and MonoBleedingEdge directories.

Because the il2cpp directory that comes with Editor on different platforms is slightly different, LocalIl2CppData needs to distinguish the platform.

Due to Unity's own reasons, WebGL target packaging does not support local installation and must be installed globally. You need to manually replace the libil2cpp directory, and set `useGlobalIl2cpp=true` in HybriCLRSettings.

### A small modification of the Unity Editor

The principle has been introduced in the previous section `Special Operations Related to Unity Version`.

## Precautions

Due to Unity's caching mechanism, after updating HybridCLR, be sure to clear the Library\Il2cppBuildCache directory, otherwise the latest code will not be used when packaging. If you use Installer to automatically install or update HybridCLR, it will automatically clear these directories without any additional action on your part.




