---
title: Hot update MonoBehaviour
date: 2022-05-25 11:50:18
permalink: /hybridclr/monobehaviour/
categories:
    - HybridCLR
tags:
    -
author:
    name: Code Philosophy
    link: https:://code-philosophy.com
---

# Hot update MonoBehaviour

HybridCLR fully supports hot update MonoBehaviour and ScriptableObject workflow, that is, you can add hot update scripts on GameObject in the code or mount them directly on resources
Hot update script. However, due to the particularity of Unity's resource management mechanism, some special processing needs to be done in the packaging workflow for mounting hot update scripts on resources.

## Use by code

`AddComponent<T>()` or `AddComponent(Type type)` are fully supported at any time. You only need to load the hot update dll to the runtime through Assembly.Load in advance
within.

## Mount MonoBehaviour on resources or create ScriptableObject type resources

When the Unity resource management system deserializes the hot update script in the resource, the following conditions need to be met:

1. The dll where the script is located has been loaded into the runtime
1. It must be a resource packaged with AssetBundle (frames such as **addressable that indirectly use ab can also**)
1. The dll where the script is located must be added to the assembly list file generated during packaging. This list file is loaded when unity starts, immutable data. The list file names and formats are different for different versions of Unity.

If no processing is done on the packaging process, since the hot update dll has been removed in the `IFilterBuildAssemblies` callback, it will definitely not appear in the assembly list file.
Since condition 3 is not met, the hot update script mounted in the hot update resource cannot be restored, and a `Scripting Missing` error will occur during runtime.

Therefore, we have made special processing in the `Editor/BuildProcessors/PatchScriptingAssemblyList.cs` script, adding the hot update dll to the assembly list file.
You need to add the hot update assembly in the project to `HotUpdateAssemblyDefinitions or HotUpdateAssemblies field of HybridCLRSettings configuration`.

It only restricts hot update resources to be packaged in the form of ab package, and there is no limit to the way hot update dll is packaged. You can freely choose the hot update method according to the project requirements**, you can package the dll into ab, or bare data
files, or encrypted compression, etc. As long as it can be guaranteed to use Assembly.Load to load the hot update resource before loading it.

## Assembly list file

The names and formats of the assembly list files are different in different Unity versions.

- 2019 version. It is a globalgamemanagers file when uncompressed and packaged. When compressed and packaged, it is first saved to the globalgamemanagers file, and then packaged into the data.unity3d file in BundleFile format and other files.
- 2020-2021 version. Saved in the ScriptingAssembles.json file.

## Known Issues

### GameObject.GetComponent(string name) interface cannot get component

This is a known bug, which is related to the code implementation of unity. This problem occurs only when the hot update script is mounted on the hot update resource. The hot update script added through AddComponent in the code can be found by this method. If you encounter this problem please use `GameObject.GetComponent<T>()` or `GameObject.GetComponent(typeof(T))` instead

## Other

Do not modify the name of the dll where the script that needs to be linked to the resource is online, because the assembly list file cannot be modified after it is packaged.

It is recommended not to disable TypeTree when typing AB, otherwise the normal AB loading method will fail. (The reason is that for scripts that disable TypeTree, Unity will verify the signature of the script in order to prevent the binary mismatch from causing process crash during the deserialization of MonoBehaviour. The content of the signature is the Hash generated by the script FullName and TypeTree data, but because we The hot update script information does not exist in the packaged installation package, so the verification will definitely fail)

If TypeTree must be disabled, a workaround is to disable the Hash verification of the script. In this case, the user must ensure that the code is consistent with the resource version when packaging, otherwise it may cause Crash, sample code

```csharp
    AssetBundleCreateRequest req = AssetBundle.LoadFromFileAsync(path);
    req.SetEnableCompatibilityChecks(false); // Non-public, needs to be called through reflection
```
