---
title: Start Up
date: 2022-05-25 11:14:58
permalink: /luban/start_up/
categories:
  - luban
tags:
  - 
author: 
  name: walon
  link: https://github.com/pirunxi
---
# Start Up

> Thanks to [**宝鱼偷偷摸鱼**](https://space.bilibili.com/1916310) contributed video tutorial:[**【01】新手上路**](https://www.bilibili.com/video/BV1xS4y1M7Aj) [**【02】定义配置结构**](https://www.bilibili.com/video/BV1m44y1j747) </br>
> Thanks to [**L**](https://github.com/LiuOcean) open source  [Luban Unity tool](https://github.com/LiuOcean/Luban_Unity_GUI)

## Install

1. Install [dotnet sdk 6.0](https://dotnet.microsoft.com/download/dotnet/6.0)
2. Download [luban_examples project](https://github.com/focus-creative-games/luban_examples)
     The project contains test configurations, the latest [Luban Release](https://github.com/focus-creative-games/luban/releases), and a large number of example projects. For convenience, the files mentioned later refer to the files in this project by default.

## Configuration and code generation

The configuration is generated using the example MiniTemplate, which can be manipulated directly in the folder, or copied to a new directory. If the path is changed, please note that the path of the script file using the luban tool in this example is `..\Tools\Luban.ClientServer\Luban.ClientServer.dll`, which may need to be changed to the path you use.

The directory and file description are as follows, and it can be generated normally by executing the gen script.

```
luban_examples\MiniTemplate
│  .cache.meta                     # luban cache file
│  gen.bat                         # bat generate script
│  gen.sh                          # sh generate script
│
├─Datas                            # Data source directory
│      item.xlsx                   # excel data source file
│      __beans__.xlsx              # bean definition file, you can use xml definition instead
│      __enums__.xlsx              # enum definition file, you can use xml definition instead
│      __tables__.xlsx             # table definition file, you can use xml definition instead
│
├─Gen                              # Generated code directory
├─output_json                      # generated json file directory
└─Defines
        __root__.xml               # luban root file
```

The example here generates a json configuration file and a corresponding cs configuration code file. When using it, just construct a loader method and pass it into the constructor of Tables.

### Configuration example
The following is a brief explanation of the file configuration format with a new table. The content of the file is as follows:

   |##var|id|name|desc|count|
   |-|-|-|-|-|
   |##type|int|string|string|int|
   |##|id|Name|Description|Number|
   ||1001|item1| desc1| 10|
   ||1002|item2| desc2| 10|

- Row 1 is the main field row and contains table field definitions. Cell A1 must start with ##. Indicates that this is a valid data table.
   - Row 2 is the type row, cell 1 must be ##type.
   - Line 3 is a comment line. To ... beginning. There can be 0-N comment lines, and they can appear anywhere
   - From line 4 onwards are data lines.

Add a table statement to __tables__.xlsx in the Datas directory, and the creation of the reward table is now complete! As shown below:

  |##var|full_name|value_type|define_from_file|input|...|
  |-|-|-|-|-|-|-|
  ||demo.TbReward|Reward|true|reward.xlsx||

**For lines with names like ##var or ##type, you can adjust the position of the line at will.** **But Note** If the first line is a comment line, ##comment must be used instead of ##. Otherwise, it will take the first line as the field name line and make an error (this is for compatibility, the first line was forced to be the field name line in the early days, and only the beginning with ## is allowed).


## Generate code and data and use it in the program

There are several common requirements, select the appropriate document below according to your requirements

- unity + c# + json
- unity + puerts + json
- UE4 + c++ + binary
- UE4 + blueprint c++ + binary
- UE4 + blueprint c++ + json
- Export json from excel, load it with your own handwritten code or use it for other purposes
- other demands

### unity + c# + json

An example reference project is [Csharp_Unity_Json](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_Unity_json)。

- Project preparation.

     Copy the Assets\LubanLib directory in the sample project to your Unity project (you can freely organize the location), **===At the same time, enable the unsafe option in Unity’s PlayerSettings===** (If your project requires not to enable unsafe, please Ask for help in the group), try to compile the project at this time, theoretically it should be able to compile successfully.

- Run the build command (you can refer to the gen_code_json.bat of the sample project)

    ```shell
    dotnet %Luban.ClientServer.dll%
    -j cfg ^
    -- ^
    --define_file <__root__.xml 定义文件的路径> ^
    --input_data_dir <path to configuration data root directory (Datas)> ^
    --output_code_dir <path to generated code file> ^
    --output_data_dir <path to exported data file> ^
    --service all ^
    --gen_types "code_cs_unity_json,data_json"
    ```

    One of them

  - %Luban.ClientServer.dll% points to luban_examples/Tools/Luban.ClientServer/Luban.ClientServer.dll
  - --define_file parameter is the path of MyConfigs/Defines/\_\_root\_\_.xml
  - --input_data_dir parameter is the path of MyConfigs/Datas
  - --output_code_dir parameter is the path where the generated code files are stored. It is recommended to point to a certain level of subdirectory under the Assets directory of unity
  - --output_data_dir parameter is the storage path of the generated data files. It is recommended to point to the same level directory as Assets.

    For detailed command documentation, please see [command_tools](/en/luban/command_tools/).

    If everything is fine, a series of logs will be generated, and the final line is == succ == .

    like this

::: center
![生成结果](/img/luban/install/install_07.png)
:::
    If everything goes well. The generated code files will be in the directory specified by the –output_code_dir parameter, and the generated configuration data will be in the directory specified by the –output_data_dir parameter. Make sure that the directory pointed to by –output_code_dir is under the Assets directory, and enable unsafe in **PlayerSetting**, and the compilation should be successful at this time.

- load configuration

    Only one line of code can complete the loading tool for all configuration tables

    ```csharp
    var tables = new cfg.Tables(file => 
            JSON.Parse(File.ReadAllText(gameConfDir + "/" + file + ".json")
        ));
    ```

- Use the loaded configuration table

    cfg.Tables contains an instance field for all configuration tables. After loading cfg.Tables, you only need to use tables.&lt;table name&gt; to get the table instance, and then you can do various operations. For example, we want to get the prop with id = 10000. code show as below

    ```csharp
    cfg.item.Item itemInfo = tables.TbItem.Get(10000);
    Console.WriteLine("id:{0} name:{1} desc:{2}", 
        itemInfo.Id, itemInfo.Name, itemInfo.Desc);
    ```

    You may notice that when defining Item in item.xml, the first letters of the field names id, name, and desc are capitalized. This is because the tool will automatically convert the field name of the corresponding code style according to the output language, that is, boo_bar will be converted to a name like BooBar. This is why it is recommended to use the xx_yy_zz style uniformly when configuring field definitions.

- This completes the configuration loading and use!

### unity + puerts project generates ts code and generates json data

The reference project is [TypeScript_Unity_Puerts_Json](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/TypeScript_Unity_Puerts_Json)

- Create and run the build command (you can refer to the gen_code_json.bat of the sample project)

    ```shell
    dotnet %Luban.ClientServer.dll%
    -j cfg ^
    -- ^
    --define_file <path to __root__.xml definition file> ^
    --input_data_dir <path to configuration data root directory (Datas)> ^
    --output_code_dir <path to generated code file> ^
    --output_data_dir <path to exported data file> ^
    --service all ^
    --gen_types code_typescript_json,data_json ^
    --typescript:use_puerts_bytebuf ^
    --typescript:embed_bright_types 
    ```

    one of them

  - %Luban.ClientServer.dll% points to luban_examples/Tools/Luban.ClientServer/Luban.ClientServer.dll
  - --define_file parameter is the path of MyConfigs/Defines/\_\_root\_\_.xml
  - --input_data_dir parameter is the path of MyConfigs/Datas
  - The --output_code_dir parameter is the path where the generated code files are stored. It is recommended to point to a certain level of subdirectory under the Assets directory of unity
  - The --output_data_dir parameter is the storage path of the generated data files. It is recommended to point to the same level directory as Assets.

    For detailed command documentation, please see [command_tools](/en/luban/command_tools/).

    If everything is fine, a series of logs will be generated, and the final line is == succ == .

- load configuration

    Provide a Loader for cfg.Tables, and return a loaded JSON object according to the table name. Only a small amount of code can complete the loading tool for all configuration tables.

    ```typescript
    let tables = new cfg.Tables(f => {
        let data = JsHelpers.ReadAllText(UnityEngine.Application.dataPath + "GameData/" + f + ".json");
        return JSON.parse(data);
    })
    ```

- Use the loaded configuration table

    cfg.Tables contains an instance field for all configuration tables. After loading cfg.Tables, you only need to use tables.&lt;table name&gt; to get the table instance, and then you can do various operations. For example, we want to get the prop with id = 10000. code show as below

    ```typescript
    console.log(tables.TbGlobalConfig.bagCapacity)
    console.log(tables.TbItem.get(1).name)
    ```

- This completes the configuration loading and use!

### UE4 project, c++ (non-blueprint) code, binary data

The reference project for the benchmark is [Cpp_Unreal_bin](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Cpp_Unreal_bin).

Since the generated code depends on some header files, you need to copy Source\Cpp_Unreal\Private\bright from this project to a suitable location for your project. You must ensure that the bright directory is within the include directory path, such as #include "bright/serialization/ByteBuf.h" in the generated code to find this file.

Then the command line parameter takes --gen_types "code_cpp_bin,data_bin"

### export json data from excel, load and use it with handwritten code

The example is gen_data_json2.bat under [GenerateDatas project](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_Unity_json)
(Note that it is not gen_data_json.bat, because '--gen_types data_json' in gen_data_json.bat, the generated json data is a list of records, rather than organized in the form of key-value, which may not meet your requirements).

The script is as follows:

```shell
dotnet %Luban.ClientServer.dll%
 -j cfg ^
 -- ^
 --define_file <__root__.xml path to definition file> ^
 --input_data_dir <Configure the path of the data root directory (Datas)> ^
 --output_data_dir <The path to the exported data file> ^
 --service all ^
 --gen_types data_json2

```

One of them

- %Luban.ClientServer.dll% points to luban_examples/Tools/Luban.ClientServer/Luban.ClientServer.dll
- --define_file parameter is the path of MyConfigs/Defines/\_\_root\_\_.xml
- --input_data_dir parameter is the path of MyConfigs/Datas
- The --output_data_dir parameter is the storage path of the generated data files. It is recommended to point to the same level directory as Assets.

Run the script at this point. Should be able to execute successfully. The generated data is in the directory specified by the --output_data_dir parameter

## Other item types
  
Between different projects, only the preparation work and --gen_types are different, please find your project from [Example Project](https://github.com/focus-creative-games/luban_examples/tree/main/Projects) For matching items, refer to gen_xxx.bat in the corresponding directory.

The generated code generally depends on some tool classes, please copy these codes from the corresponding project to your own project.

For more information, please refer to [Code and Data Generation](/en/luban/generate_code_data/) this document.
