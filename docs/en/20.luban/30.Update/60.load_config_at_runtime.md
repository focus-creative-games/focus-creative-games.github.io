---
title: Load Configuration At Runtime
date: 2022-05-25 11:14:58
permalink: /luban/load_config_at_runtime/
categories:
  - luban
tags:
  - 
author: 
  name: Code Philosophy
  link: https:://code-philosophy.com
---
# load configuration at runtime

## In the unity + json project, luban is used to generate code, which libraries need to be relied on

Just copy the [LubanLib](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_Unity_json/Assets/LubanLib) directory to the project.

## Use luban to generate code in other projects, which libraries need to depend on

Find an example project that matches your project in [Example Project](https://github.com/focus-creative-games/luban_examples/tree/main/Projects), and import Luban-related basic code into your project. Can.

## I added the code to the project, and found that there was a compilation error, and the ByteBuf class could not be found. How to solve it?

Because you didn't add some code that luban depends on to the project. Refer to the answer above.

## Use c# code to load json configuration in unity project

just one line of code

```csharp
// One line of code can load all configurations. cfg.Tables contains an instance field for all tables.
var tables = new cfg.Tables(Loader);
// Access a singleton table.
Console.WriteLine(tables.TbGlobal.Name);
// Access to normal key-value tables.
Console.WriteLine(tables.TbItem.Get(12).Name);
// Support for operator[] usage.
Console.WriteLine(tables.TbMail[1001].Desc);
```

Please implement a suitable Loader function by yourself, and return a loaded ByteBuf according to the configuration file name file. You can learn from the code in [Csharp_Unity_Json](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_Unity_json).

## Use c# code in the unity project to automatically determine the loading bin or json configuration

During the development period, I hope to use the json export format, but in order to save the export file size and improve loading performance, I hope to use the bin export format. By creating cfg.Tables through reflection, you can automatically adapt to these two methods without changing the code.

```csharp
    void Start()
    {
        var tablesCtor = typeof(cfg.Tables).GetConstructors()[0];
        var loaderReturnType = tablesCtor.GetParameters()[0].ParameterType.GetGenericArguments()[1];
        // Determine whether to use json or ByteBuf Loader according to the return value type of Loader in the constructor of cfg.Tables
        System.Delegate loader = loaderReturnType == typeof(ByteBuf) ?
            new System.Func<string, ByteBuf>(LoadByteBuf)
            : (System.Delegate)new System.Func<string, JSONNode>(LoadJson);
        var tables = (cfg.Tables)tablesCtor.Invoke(new object[] {loader});

        // Access a singleton table.
        Console.WriteLine(tables.TbGlobal.Name);
        // Access to normal key-value tables.
        Console.WriteLine(tables.TbItem.Get(12).Name);
        // Support for operator[] usage.
        Console.WriteLine(tables.TbMail[1001].Desc);
    }

    private static JSONNode LoadJson(string file)
    {
        return JSON.Parse(File.ReadAllText($"{Application.dataPath}/../../GenerateDatas/json/{file}.json", System.Text.Encoding.UTF8));
    }

    private static ByteBuf LoadByteBuf(string file)
    {
        return new ByteBuf(File.ReadAllBytes($"{Application.dataPath}/../../GenerateDatas/bytes/{file}.bytes"));
    }
```

You can learn from the code in [Csharp_Unity_bin_or_json](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_Unity_bin_or_json).

## Use typescript to load json configuration in unity+puers project

```typescript
// One line of code can load all configurations. cfg.Tables contains an instance field for all tables.
let tables = new cfg.Tables(loader)
// access a singleton table
console.log(tables.TbGlobal.name)
// Access to normal key-value tables
console.log(tables.TbItem.get(12).Name)
```

Please implement a Loader function by yourself, and return a parsed JSON object according to the table file. You can learn from the code in [Typescript_Unity_Puerts_Json](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/TypeScript_Unity_Puerts_Json)

## How to load json configuration in go project

```go
// One line of code can load all configurations. cfg.Tables contains an instance field for all tables.
if tables , err := cfg.NewTables(loader) ; err != nil {
 println(err.Error())
 return
}
// Access a singleton table.
println(tables.TbGlobal.Name)
// Access to normal key-value tables.
println(tables.TbItem.Get(12).Name)

```

Please implement a suitable loader function by yourself, and return a Json object according to the configuration file

## python 2 + json

Similar to others, take --gen_types code_python27_json,data_json. However, the enum34 package needs to be installed additionally, which can be installed through the command 'py -2 -m pip install enum34'.

## If the language I use is java, python, c++, rust, lua, etc., how to load the configuration

See [Example Projects](https://github.com/focus-creative-games/luban_examples/tree/main/Projects). Find an example project that matches your project type, and refer to it to load
code.
