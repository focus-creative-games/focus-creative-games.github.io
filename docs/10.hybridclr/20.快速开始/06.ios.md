---
title: IOS平台打包
date: 2022-05-29 20:55:59
permalink: /hybridclr/ios/
categories:
  - HybridCLR
tags:
  - 
author: 
  name: walon
  link: https://github.com/ShuaiGao
---

此文档默认您已经了解了在Windows或mac下的打包构建流程，并了解了相关注意事项。

# IOS打包

Unity ios打包时会生成xcode工程，在xcode工程中并没有使用il2cpp源码（与其它平台打包不同），而是使用了提前编译好的libil2cpp.a。所以在xcode编译时需要替换成使用HybridCLR编译的libil2cpp.a。

编译过程使用的脚本在[HybridCLR仓库的scripts/iOSBuild目录](https://github.com/focus-creative-games/hybridclr/tree/main/scripts/iOSBuild)

替换xcode工程中的libil2cpp.a文件请自行完成，下面只介绍如何编译libil2cpp.a。

## libil2cpp.a 编译

libil2cpp.a 的编译依赖于下面三个目录。也就是说编译 .a 使用的源文件，不是非要放到unity安装路径下的，你可以放到任意路径并构建下面的路径关系。



### 第1步 准备一个改造过的包含HybridCLR的il2cpp目录

原始的il2cpp目录在Unity的安装目录，路径类似这样 `/Applications/Unity/Hub/Editor/{your_unity_version}/Unity.app/Contents/il2cpp`。

我们需要修改的是il2cpp目录下的libil2cpp目录。 怎么修改参见 [快速上手](/hybridclr/start_up/) 文档。改造后的il2cpp目录类似这样：

```text
il2cpp
├─libil2cpp
│    ├─huatuo      
└─external
```

你可以直接修改原始安装目录的 il2cpp/libil2cpp目录，也可以将原始的il2cpp目录复制到一个新的位置 new_il2cpp，然后再参见上面的文档修改它。


### 第2步 设置环境变量


#### `HUATUO_IL2CPP_SOURCE_DIR` 必须设置

设置环境变量 `HUATUO_IL2CPP_SOURCE_DIR`, 指向上一步中准备好的il2cpp目录。命令类似这样 

```bash
export HUATUO_IL2CPP_SOURCE_DIR=il2cpp目录位置
```

#### `IPHONESIMULATOR_VERSION` 可设置或者不设置

该变量指示了iPhoneSimulator版本，未设置时使用系统默认iPhoneSimulator版本。设置命令类似这样

```bash
export IPHONESIMULATOR_VERSION=15.5
```


### 第3步 编译il2cpp

[scripts/iOSBuild](https://github.com/focus-creative-games/hybridclr/tree/main/scripts/iOSBuild) 目录下执行以下命令

   ```bash
   mkdir build
   cd build
   cmake ..
   make -j4
   ```

编译结束，即生成 libil2cpp.a。

::: warning 注意
编译生成的libil2cpp.a，如果你的文件小于120M那应该是有地方出错了，即漏掉了一部分代码，极有可能是没有替换libil2cpp文件夹，只拷贝了huatuo目录。
:::

## 注意事项

当前cmake文件不能通过cmke客户端工具运行，只能通过脚本执行
