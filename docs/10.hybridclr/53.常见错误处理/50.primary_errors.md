---
title: 初级版常见错误
date: 2022-08-23 09:00:00
permalink: /hybridclr/errors/primary_errors/
categories:
  - HybridCLR
  - errors
tags:
  - 
author: 
  name: walon
  link: https://github.com/pirunxi
---
# 初级版常见错误

# 初期使用时的出现的问题

## 遇到Currently selected scripting backend (IL2CPP) is not installed
请去Unity官网或者Unity Hub下载安装il2cpp模块。

## 遇到git不是内部或外部命令，也不是可运行的程序
请去安装git，具体步骤请自行搜索。

# 打包时出现的问题

## 遇到Undefined symbols for architecture arm64:"Il2CppCodeGenWriteBarrier(void**, void*)", referenced from:...
把Unity Editor PlayerSetting中Increasemental GC勾掉。

## 遇到Async 调用Editor和打包后执行不一致的问题

如果代码在async里抛了异常，又没有捕获异常，会导致悄无声息失败，目前万一在async里因为裁剪或者aot泛型原因出错，会出现这种没有任何错误提示的情况。从而导致出现行为不一致。

解决方案：捕获async异常，然后解决对应异常。

## 打包生成Visual Studio Project后，编译出现错误找不到Windows SDK版本或无法打开.....\binUnityPlayerStub.lib

  打包生成的C++工程中，依赖关系为：项目主工程（同unity项目名，当前启动项目）依赖Il2CppOutputProject，Il2CppOutputProject依赖UnityPlayerStub。但是生成的工程设置中并没有设置依赖，一般按照下面的设置就能解决：

  1. 编译UnityPlayerStub项目，遇到问题就修改项目设置里面的 Windows SDK Version 和 Platform ToolSet
  2. 编译Il2CppOutputProject 项目
  3. 启动成功

## Android 打包遇到 additional relocation overflows omitted from the output

这个问题是由Unity 2020 Android NDK的bug引起的，在il2cpp代码生成的时候，会生成大量代码，导致编译的链接时期崩溃。在Unity 2021 版本bug被修复了。

引起这个问题一般是由于开启了Debug，只要取消掉**Development Build**选项就可以了。使用DOTS打包时设置如下图：

::: center
![DOTS设置release](/img/dots_release.png)
:::

::: tip
如果遇到这个问题，说明打包的时候代码过多了，可以检查下link.xml文件，看下是不是防裁剪配置粒度过大，导致太多代码被打包进去了。
:::  

## A scripted object (probably XXX?) has a different serialization layout when loading. Did you #ifdef UNITY_EDITOR a section of your serialized properties in any of your scripts?

有几个原因：

- 不能直接从ScriptAssemblies里拷贝dll，因为可能会包含不正确的宏开关，导致引用了Editor或者其他代码。必须使用脚本编译。可参见 [HybridCLREditorHelper](https://github.com/focus-creative-games/hybridclr_trial/blob/main/Assets/Editor/HybridCLR/EditorHelper.cs) 中 CompileDll 代码。
- 资源必须从AssetBundle中加载才能正确恢复。放到Resources目录或者随包的Scene资源都不能正确恢复。



# il2CPP问题

## 遇到  "This icall is not supported by il2cpp at System.AppDomain.Load"

有两种原因

1. 如果非ios平台，则因为未替换libil2cpp目录
2. 如果ios平台，因为ios平台并不从源码编译libil2cpp，而是使用随Editor打包的libil2cpp.a，你需要替换libil2cpp.a为HybridCLR的编译版本。编译方式请看[IOS Build](/hybridclr/ios/)

## win下 遇到error LNK2019 报错 或 mac下遇到 Undefined symbol报错

这两个报错出现在编译链接时，原因是符号不存在，即需要链接的方法在对应的库里不存在，引起该错误已知的问题如下：

1. 有的插件不支持il2cpp可能会引起这类错误，比如 UniversalMediaPlayer

2. 在ios打包，使用xcode编译时，libil2cpp.a 编译出错导致了部分符号丢失

解决办法：

1. 移除不支持的插件

2. 重新编译libil2cpp.a

## 遇到Undefined symbol:_HybridCLRApi_XXX

请重新编译libil2cpp.a文件

## unsupported internal call for il2cpp。例如：unsupported internal call for il2cpp:string::RedirectToCreateString。
这种错误表示调用了一个il2cpp未实现的函数。例如，unsupported internal call for il2cpp:string::RedirectToCreateString，指错误地调用了new string(char[]) 这种函数。il2cpp不支持从char[]构造字符串。

# 热更问题

## 遇到 Unity: TypeLoadException: Could not load type 'System.Object' from assembly 'netstandard'

目前支持.net standard 2.0，但要求主工程打包用.net standard，而热更新dll打包**必须用.net 4.x**。原因是unity使用.net standard打包时，会自动剥除.net standard的依赖，直接依赖最终的dll，导致主工程的dll列表中实际上不存在net standard这个dll，进而导致热更新dll加载时，找不到来自netstandard的对象。

解决办法为编译热更新部分时api compatible level切换为.net 4.x或 .net framework即可。

如果使用了第三方dll形式的插件，并且插件只支持.net standard。将插件放到主工程也能正常工作，但不能放到热更新部分。对依赖.net 4.x的插件则无限制，都能正常工作。

如果还发生错误，则删除Library目录，重新操作一次。

热更新dll也使用.net standard打包也是有办法正常工作的。需要在加载热更新dll前先手动加载.net standard dll，但这导致增加无谓的空间和内存占用，因此不建议这么操作。况且HybridCLR目前还不支持export type特性，实际上仍然是不能工作的。

## 遇到'Mono.Cecil.AssemblyResolutionException:Failed to resolve assembly'  '../Assembly-CSharp.dll'
失误地在主工程中引用了热更新项目，解决方法：删除hotfix.dll，就可以知道哪儿有引用错误，根据情况进行修复。
