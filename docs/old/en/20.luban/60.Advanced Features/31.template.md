---
title: Custom Template
date: 2022-05-25 11:14:58
permalink: /luban/advanced/template/
categories:
  - luban
  - advanced
tags:
  - 
author: 
  name: Code Philosophy
  link: https:://code-philosophy.com
---
# Custom template

## Introduce

Luban uses the [scriban](https://github.com/scriban/scriban) template engine to generate code, and also uses this template to generate custom text data files.

Template files are in the Luban.Servers/Templates directory.

[Template Usage Introduction](https://app.heptabase.com/w/514c9827e9627b063281903b68ed662773c45c845d90f8da1da04dd1e6fc08c4) from [LiuOcean](https://github.com/LiuOcean)

## Custom template search path

Although you can directly modify the template files in the Luban.Server/Templates directory, each update of Luban.Server will overwrite its own implementation, which is not very convenient.
Luban.Server supports template search path, Luban.Server command line parameter "-t, --template_search_path path" is used to specify the priority search path.

## Module caching mechanism

To optimize performance, Luban.Server keeps a template cache after loading template files at runtime. When debugging a template, the cache mechanism will not reload the template file, requiring frequent restarts, which is inconvenient. can pass parameters
"--disable_cache" disables caching.

## code template

Custom code template examples can be found in [Csharp_CustomTemplate_AsyncLoad](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_CustomTemplate_AsyncLoad).

See the gen_template_xxxx.bat file in [Script Directory](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/GenerateDatas) for an example of the generated script.

### Template environment variables

The environment variables provided by default for each template are different. The environment variables of code and data templates are different. Data templates are also divided into convert templates (conversion from source data format to source data format) and data templates (source data format to export format) conversion).

#### Code Template Environment Variables

- x type definition. DefEnum for enum, DefBean for bean, DefTable for table
- assembly. The current definition set. Note that it is not the dll assembly of c#, but the collection of all type information currently defined in your configuration

#### convert data template environment variable

- The type definition of the DefTable where the table resides.
- data The corresponding DType data of the current record
- assembly The current definition set.

#### data data template environment variable

- The type definition of the DefTable where the table resides.
- datas DType list of all exported data of the current table, that is, List, DType type.
- assembly The current definition set.

## data template

When the generation parameter --gen_types contains data_template, it is a custom data template mode, and you need to use --template_name \<template_name\> to specify the template name (note that the template name does not contain the .tpl suffix), in \<template search path In the \>/config/data directory, look for the \<template_name\>.tpl file.

For example "--gen_types data_template --template_name lua" will look for the config/data/lua.tpl file from the search path.

  Example template files are under [CustomTemplates](https://github.com/focus-creative-games/luban_examples/tree/main/Projects/DataTemplates/CustomTemplates/config/data).

## Customize the suffix of the data file output by the data template file

luban will intelligently guess the file type from the template_name parameter, and give an output file name by default. If the guess fails and the --data_file_extension option is not specified, an error will be reported.
Like lua2, lua, lua_test, my_lua_template will guess as lua type.