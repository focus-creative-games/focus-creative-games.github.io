<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Modify Unity editor related dll | Code Philosophy</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.png">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="Code Philosophy是一个业内领先的专注于提供游戏行业深度技术解决方案的创新型公司。">
    <meta name="keywords" content="HybridCLR,luban,热更新,配表,配置,游戏,git,github">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.de16ca54.css" as="style"><link rel="preload" href="/assets/js/app.12d5fdbe.js" as="script"><link rel="preload" href="/assets/js/2.0771a7ec.js" as="script"><link rel="preload" href="/assets/js/113.fc2f8b72.js" as="script"><link rel="preload" href="/assets/js/3.8d0c7075.js" as="script"><link rel="prefetch" href="/assets/js/10.d15b8a0c.js"><link rel="prefetch" href="/assets/js/100.59f432fb.js"><link rel="prefetch" href="/assets/js/101.3de7bbde.js"><link rel="prefetch" href="/assets/js/102.4a0758d3.js"><link rel="prefetch" href="/assets/js/103.26383b9f.js"><link rel="prefetch" href="/assets/js/104.a1da4ecb.js"><link rel="prefetch" href="/assets/js/105.ef6a6e83.js"><link rel="prefetch" href="/assets/js/106.da96dd79.js"><link rel="prefetch" href="/assets/js/107.ec48bd70.js"><link rel="prefetch" href="/assets/js/108.0f684202.js"><link rel="prefetch" href="/assets/js/109.2a494194.js"><link rel="prefetch" href="/assets/js/11.764b6824.js"><link rel="prefetch" href="/assets/js/110.84415013.js"><link rel="prefetch" href="/assets/js/111.b2685030.js"><link rel="prefetch" href="/assets/js/112.d97b1c0a.js"><link rel="prefetch" href="/assets/js/114.389fdf76.js"><link rel="prefetch" href="/assets/js/115.d7da7753.js"><link rel="prefetch" href="/assets/js/116.7ba543d5.js"><link rel="prefetch" href="/assets/js/117.d7087ed2.js"><link rel="prefetch" href="/assets/js/118.afcabf3e.js"><link rel="prefetch" href="/assets/js/119.2bcae880.js"><link rel="prefetch" href="/assets/js/12.8d2b0d29.js"><link rel="prefetch" href="/assets/js/120.e7473c03.js"><link rel="prefetch" href="/assets/js/121.e7f1865f.js"><link rel="prefetch" href="/assets/js/122.1ee03f15.js"><link rel="prefetch" href="/assets/js/123.8c8de603.js"><link rel="prefetch" href="/assets/js/124.1c8fa702.js"><link rel="prefetch" href="/assets/js/125.92167af0.js"><link rel="prefetch" href="/assets/js/126.d729738c.js"><link rel="prefetch" href="/assets/js/127.291f69f0.js"><link rel="prefetch" href="/assets/js/128.08210df8.js"><link rel="prefetch" href="/assets/js/129.40b77886.js"><link rel="prefetch" href="/assets/js/13.e0289cd0.js"><link rel="prefetch" href="/assets/js/130.8305c052.js"><link rel="prefetch" href="/assets/js/131.5e6ae27f.js"><link rel="prefetch" href="/assets/js/132.d9c12ddc.js"><link rel="prefetch" href="/assets/js/133.82886760.js"><link rel="prefetch" href="/assets/js/134.6f64a5d9.js"><link rel="prefetch" href="/assets/js/135.b90b8356.js"><link rel="prefetch" href="/assets/js/136.24e466af.js"><link rel="prefetch" href="/assets/js/137.aaf435ae.js"><link rel="prefetch" href="/assets/js/138.00c60cde.js"><link rel="prefetch" href="/assets/js/139.14e869b2.js"><link rel="prefetch" href="/assets/js/14.81465e75.js"><link rel="prefetch" href="/assets/js/140.de231325.js"><link rel="prefetch" href="/assets/js/141.4ad5ea60.js"><link rel="prefetch" href="/assets/js/142.f36e159e.js"><link rel="prefetch" href="/assets/js/143.2e4611d8.js"><link rel="prefetch" href="/assets/js/144.e9ebb3fa.js"><link rel="prefetch" href="/assets/js/145.1a9f5fad.js"><link rel="prefetch" href="/assets/js/146.624849a0.js"><link rel="prefetch" href="/assets/js/147.461906c5.js"><link rel="prefetch" href="/assets/js/148.d28d7aaa.js"><link rel="prefetch" href="/assets/js/149.9784b5ed.js"><link rel="prefetch" href="/assets/js/15.6b1ebda0.js"><link rel="prefetch" href="/assets/js/150.240e44d2.js"><link rel="prefetch" href="/assets/js/151.604089c9.js"><link rel="prefetch" href="/assets/js/152.f73b8be0.js"><link rel="prefetch" href="/assets/js/153.e16a3cbb.js"><link rel="prefetch" href="/assets/js/16.9f462aa4.js"><link rel="prefetch" href="/assets/js/17.f6132239.js"><link rel="prefetch" href="/assets/js/18.a0728471.js"><link rel="prefetch" href="/assets/js/19.647597ef.js"><link rel="prefetch" href="/assets/js/20.113a110f.js"><link rel="prefetch" href="/assets/js/21.e8949420.js"><link rel="prefetch" href="/assets/js/22.715d702b.js"><link rel="prefetch" href="/assets/js/23.0c731f9a.js"><link rel="prefetch" href="/assets/js/24.83715717.js"><link rel="prefetch" href="/assets/js/25.a6efb8d9.js"><link rel="prefetch" href="/assets/js/26.876b7bf2.js"><link rel="prefetch" href="/assets/js/27.7e6a1fbc.js"><link rel="prefetch" href="/assets/js/28.c9603a98.js"><link rel="prefetch" href="/assets/js/29.7a6ffd69.js"><link rel="prefetch" href="/assets/js/30.bbdcda14.js"><link rel="prefetch" href="/assets/js/31.441495f6.js"><link rel="prefetch" href="/assets/js/32.516dc27e.js"><link rel="prefetch" href="/assets/js/33.796a4638.js"><link rel="prefetch" href="/assets/js/34.b844a239.js"><link rel="prefetch" href="/assets/js/35.4489eede.js"><link rel="prefetch" href="/assets/js/36.4944cc18.js"><link rel="prefetch" href="/assets/js/37.2b295b6f.js"><link rel="prefetch" href="/assets/js/38.c7f25fa6.js"><link rel="prefetch" href="/assets/js/39.f350b082.js"><link rel="prefetch" href="/assets/js/4.e8f1cdb3.js"><link rel="prefetch" href="/assets/js/40.6346e1bc.js"><link rel="prefetch" href="/assets/js/41.703948ac.js"><link rel="prefetch" href="/assets/js/42.cb158675.js"><link rel="prefetch" href="/assets/js/43.a6366a4f.js"><link rel="prefetch" href="/assets/js/44.67b267cd.js"><link rel="prefetch" href="/assets/js/45.d9ded0f6.js"><link rel="prefetch" href="/assets/js/46.dce204c1.js"><link rel="prefetch" href="/assets/js/47.f59b1714.js"><link rel="prefetch" href="/assets/js/48.e72d5a9a.js"><link rel="prefetch" href="/assets/js/49.57c226c6.js"><link rel="prefetch" href="/assets/js/5.765a6984.js"><link rel="prefetch" href="/assets/js/50.696d3556.js"><link rel="prefetch" href="/assets/js/51.f9fcee2c.js"><link rel="prefetch" href="/assets/js/52.e8d8f311.js"><link rel="prefetch" href="/assets/js/53.cb8fbe86.js"><link rel="prefetch" href="/assets/js/54.4df421a2.js"><link rel="prefetch" href="/assets/js/55.5a9cb469.js"><link rel="prefetch" href="/assets/js/56.7e073255.js"><link rel="prefetch" href="/assets/js/57.6756691b.js"><link rel="prefetch" href="/assets/js/58.9d1c4a46.js"><link rel="prefetch" href="/assets/js/59.a560b055.js"><link rel="prefetch" href="/assets/js/6.ddf0c9b8.js"><link rel="prefetch" href="/assets/js/60.a23590d0.js"><link rel="prefetch" href="/assets/js/61.5b3a43f9.js"><link rel="prefetch" href="/assets/js/62.72a56b46.js"><link rel="prefetch" href="/assets/js/63.ceded64f.js"><link rel="prefetch" href="/assets/js/64.f26c8cb9.js"><link rel="prefetch" href="/assets/js/65.fb45c073.js"><link rel="prefetch" href="/assets/js/66.83ebce20.js"><link rel="prefetch" href="/assets/js/67.eff63cf4.js"><link rel="prefetch" href="/assets/js/68.8bb955ae.js"><link rel="prefetch" href="/assets/js/69.dae7cec8.js"><link rel="prefetch" href="/assets/js/7.32660699.js"><link rel="prefetch" href="/assets/js/70.20e84c9c.js"><link rel="prefetch" href="/assets/js/71.6c135456.js"><link rel="prefetch" href="/assets/js/72.a6cef57b.js"><link rel="prefetch" href="/assets/js/73.ea109d55.js"><link rel="prefetch" href="/assets/js/74.31bd4677.js"><link rel="prefetch" href="/assets/js/75.e90da937.js"><link rel="prefetch" href="/assets/js/76.74f061bb.js"><link rel="prefetch" href="/assets/js/77.4a1bfa57.js"><link rel="prefetch" href="/assets/js/78.7847ecac.js"><link rel="prefetch" href="/assets/js/79.5fa65e36.js"><link rel="prefetch" href="/assets/js/8.62b0d450.js"><link rel="prefetch" href="/assets/js/80.008f19fa.js"><link rel="prefetch" href="/assets/js/81.e245ac7c.js"><link rel="prefetch" href="/assets/js/82.8f5a662c.js"><link rel="prefetch" href="/assets/js/83.cc9a1992.js"><link rel="prefetch" href="/assets/js/84.dcf087c6.js"><link rel="prefetch" href="/assets/js/85.be5afefb.js"><link rel="prefetch" href="/assets/js/86.97d6599a.js"><link rel="prefetch" href="/assets/js/87.1df10b08.js"><link rel="prefetch" href="/assets/js/88.f5a3d153.js"><link rel="prefetch" href="/assets/js/89.1a78c9ca.js"><link rel="prefetch" href="/assets/js/9.f51c0ef6.js"><link rel="prefetch" href="/assets/js/90.dfb15931.js"><link rel="prefetch" href="/assets/js/91.a5bdf350.js"><link rel="prefetch" href="/assets/js/92.4d4d7050.js"><link rel="prefetch" href="/assets/js/93.4ce8faaa.js"><link rel="prefetch" href="/assets/js/94.13bd2ab5.js"><link rel="prefetch" href="/assets/js/95.f941715f.js"><link rel="prefetch" href="/assets/js/96.6adeb803.js"><link rel="prefetch" href="/assets/js/97.6e1aaaf3.js"><link rel="prefetch" href="/assets/js/98.53de0dca.js"><link rel="prefetch" href="/assets/js/99.6f94e8b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.de16ca54.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/logo.png" alt="Code Philosophy" class="logo"> <span class="site-name can-hide">Code Philosophy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HybridCLR" class="dropdown-title"><!----> <span class="title" style="display:;">HybridCLR</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/hybridclr/about/" class="nav-link">About</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/monobehaviour/" class="nav-link">Get Started</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/benchmark/" class="nav-link">Benchmark</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/faq/" class="nav-link">FAQ</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/common_errors/" class="nav-link">Common Mistakes</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/bug_reporter/" class="nav-link">Report Bugs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Luban" class="dropdown-title"><a href="/en/luban/index/" class="link-title">Luban</a> <span class="title" style="display:none;">Luban</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/luban/about/" class="nav-link">About</a></li><li class="dropdown-item"><!----> <a href="/en/luban/start_up/" class="nav-link">Get Started</a></li><li class="dropdown-item"><!----> <a href="/en/luban/command_tools/" class="nav-link">Complete Features</a></li><li class="dropdown-item"><!----> <a href="/en/luban/data_source/" class="nav-link">Data Source</a></li><li class="dropdown-item"><!----> <a href="/en/luban/advanced/validator/" class="nav-link">Advanced Features</a></li><li class="dropdown-item"><!----> <a href="/en/luban/tools/" class="nav-link">Luban Tools</a></li></ul></div></div><div class="nav-item"><a href="/en/hybridclr/price/" class="nav-link">Service</a></div><div class="nav-item"><a href="/en/join/" class="nav-link">Jobs</a></div><div class="nav-item"><a href="https://www.zhihu.com/column/c_1489549396035870720" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Zhihu
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/en/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><!----> <span class="title" style="display:;">切换语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hybridclr/modify_unity_dll/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/modify_unity_dll/" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div> <a href="https://github.com/focus-creative-games" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/en/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HybridCLR" class="dropdown-title"><!----> <span class="title" style="display:;">HybridCLR</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/hybridclr/about/" class="nav-link">About</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/monobehaviour/" class="nav-link">Get Started</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/benchmark/" class="nav-link">Benchmark</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/faq/" class="nav-link">FAQ</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/common_errors/" class="nav-link">Common Mistakes</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/bug_reporter/" class="nav-link">Report Bugs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Luban" class="dropdown-title"><a href="/en/luban/index/" class="link-title">Luban</a> <span class="title" style="display:none;">Luban</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/luban/about/" class="nav-link">About</a></li><li class="dropdown-item"><!----> <a href="/en/luban/start_up/" class="nav-link">Get Started</a></li><li class="dropdown-item"><!----> <a href="/en/luban/command_tools/" class="nav-link">Complete Features</a></li><li class="dropdown-item"><!----> <a href="/en/luban/data_source/" class="nav-link">Data Source</a></li><li class="dropdown-item"><!----> <a href="/en/luban/advanced/validator/" class="nav-link">Advanced Features</a></li><li class="dropdown-item"><!----> <a href="/en/luban/tools/" class="nav-link">Luban Tools</a></li></ul></div></div><div class="nav-item"><a href="/en/hybridclr/price/" class="nav-link">Service</a></div><div class="nav-item"><a href="/en/join/" class="nav-link">Jobs</a></div><div class="nav-item"><a href="https://www.zhihu.com/column/c_1489549396035870720" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Zhihu
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/en/about/" class="nav-link">About</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><!----> <span class="title" style="display:;">切换语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hybridclr/modify_unity_dll/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/modify_unity_dll/" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div> <a href="https://github.com/focus-creative-games" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Content</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>About</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>hybridclr</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/hybridclr/about/" class="sidebar-link">About HybridCLR</a></li><li><a href="/en/hybridclr/start_up/" class="sidebar-link">Get started quickly</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Tutorial</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Principle</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/hybridclr/build_pipeline/" class="sidebar-link">HybridCLR packaging workflow</a></li><li><a href="/en/hybridclr/monobehaviour/" class="sidebar-link">Hot update MonoBehaviour</a></li><li><a href="/en/hybridclr/build_ios_libil2cpp/" class="sidebar-link">iOS packaging</a></li><li><a href="/en/hybridclr/differential_hybrid_execution/" class="sidebar-link">Differential Hybrid Execution</a></li><li><a href="/en/hybridclr/hybridclr_unity/" class="sidebar-link">Introduce hybridclr_unity Package</a></li><li><a href="/en/hybridclr/modify_unity_dll/" aria-current="page" class="active sidebar-link">Modify Unity editor related dll</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/en/hybridclr/modify_unity_dll/#use-the-dnspy-tool" class="sidebar-link">Use the dnspy tool</a></li><li class="sidebar-sub-header level2"><a href="/en/hybridclr/modify_unity_dll/#unityeditor-coremodule-dll" class="sidebar-link">UnityEditor.CoreModule.dll</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/en/hybridclr/modify_unity_dll/#principle" class="sidebar-link">Principle</a></li><li class="sidebar-sub-header level3"><a href="/en/hybridclr/modify_unity_dll/#replace-the-original-unityeditor-coremodule-dll" class="sidebar-link">Replace the original UnityEditor.CoreModule.dll</a></li><li class="sidebar-sub-header level3"><a href="/en/hybridclr/modify_unity_dll/#modify-with-dnspy" class="sidebar-link">Modify with dnspy</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/en/hybridclr/modify_unity_dll/#unity-il2cpp-dll" class="sidebar-link">Unity.IL2CPP.dll</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/en/hybridclr/modify_unity_dll/#principle-2" class="sidebar-link">Principle</a></li><li class="sidebar-sub-header level3"><a href="/en/hybridclr/modify_unity_dll/#unity-il2cpp-cppdeclarationswriter-write-streamwriter-writer-icppdeclarations-declarationsin-iinteropdatacollector-interopdatacollector" class="sidebar-link">Unity.IL2CPP.CppDeclarationsWriter::Write(StreamWriter writer, ICppDeclarations declarationsIn, IInteropDataCollector interopDataCollector)</a></li><li class="sidebar-sub-header level3"><a href="/en/hybridclr/modify_unity_dll/#unity-il2cpp-il2cpptypewriter-writeil2cpptypedefinitions-imetadatacollection-metadatacollection" class="sidebar-link">Unity.IL2CPP.Il2CppTypeWriter::WriteIl2CppTypeDefinitions(IMetadataCollection metadataCollection)</a></li><li class="sidebar-sub-header level3"><a href="/en/hybridclr/modify_unity_dll/#unity-il2cpp-metadata-il2cppgenericinstwriter-writeil2cppgenericinstdefinitions-iil2cppgenericinstcollectorreaderservice-genericinstcollection" class="sidebar-link">Unity.IL2CPP.Metadata.Il2CppGenericInstWriter::WriteIl2CppGenericInstDefinitions(IIl2CppGenericInstCollectorReaderService genericInstCollection)</a></li></ul></li></ul></li><li><a href="/en/hybridclr/code_striping/" class="sidebar-link">Code clipping problem</a></li><li><a href="/en/hybridclr/aot_generic/" class="sidebar-link">AOT generic problem</a></li><li><a href="/en/hybridclr/method_bridge/" class="sidebar-link">AOT-interpreter bridge function</a></li><li><a href="/en/hybridclr/memory/" class="sidebar-link">Memory-related principles</a></li><li><a href="/en/hybridclr/performance/" class="sidebar-link">Execution performance</a></li><li><a href="/en/hybridclr/limit/" class="sidebar-link">Limit</a></li><li><a href="/en/hybridclr/work_with_script_language/" class="sidebar-link">HybridCLR+lua/js/python</a></li><li><a href="/en/hybridclr/monopinvokecallback/" class="sidebar-link">MonoPInvokeCallback Support</a></li><li><a href="/en/hybridclr/supported_unity_versions/" class="sidebar-link">Version Matching Rules</a></li><li><a href="/en/hybridclr/supported_platform/" class="sidebar-link">Cross-platform Support</a></li><li><a href="/en/hybridclr/source_inspect/" class="sidebar-link">HybridCLR source code structure and debugging</a></li><li><a href="/en/hybridclr/best_practices/" class="sidebar-link">Best Practices</a></li><li><a href="/en/hybridclr/129afe/" class="sidebar-link">il2cpp bugs</a></li></ul></section></li><li><a href="/en/hybridclr/faq/" class="sidebar-link">FAQ</a></li><li><a href="/en/hybridclr/benchmark/" class="sidebar-link">Testing Report</a></li><li><a href="/en/hybridclr/business_games/" class="sidebar-link">Already launched commercial projects</a></li><li><a href="/en/hybridclr/common_errors/" class="sidebar-link">Common Errors</a></li><li><a href="/en/hybridclr/bug_reporter/" class="sidebar-link">BUG Feedback Template</a></li><li><a href="/en/hybridclr/recommended-tools/" class="sidebar-link">Related Third-party Projects</a></li><li><a href="/en/hybridclr/roadmap/" class="sidebar-link">Roadmap</a></li><li><a href="/en/hybridclr/development_story/" class="sidebar-link">Development History</a></li><li><a href="/en/hybridclr/price/" class="sidebar-link">Commercial Service</a></li><li><a href="/en/hybridclr/donate/" class="sidebar-link">Acknowledgments</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>luban</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gidb</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=en" title="分类" data-v-06225672>en</a></li><li data-v-06225672><a href="/categories/?category=hybridclr" title="分类" data-v-06225672>hybridclr</a></li><li data-v-06225672><a href="/categories/?category=Principle" title="分类" data-v-06225672>Principle</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https:://code-philosophy.com" target="_blank" title="作者" class="beLink" data-v-06225672>Code Philosophy</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-29</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Modify Unity editor related dll<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="modify-unity-editor-related-dll"><a href="#modify-unity-editor-related-dll" class="header-anchor">#</a> Modify Unity editor related dll</h1> <p>Since the Editor script and il2cpp tool provided by Unity cannot fully meet the requirements, in some Unity versions or packaged with certain target platforms, it is necessary to update the Unity Editor
Some dlls that come with it are modified.</p> <p>There are currently two dlls that have been modified:</p> <ul><li>UnityEditor.CoreModule.dll</li> <li>Unity.IL2CPP.dll</li></ul> <p>Note that not all versions and platforms need to modify these two dlls, as detailed below.</p> <h2 id="use-the-dnspy-tool"><a href="#use-the-dnspy-tool" class="header-anchor">#</a> Use the dnspy tool</h2> <p>We use <a href="https://github.com/dnSpy/dnSpy" target="_blank" rel="noopener noreferrer">dnspy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to modify dll files. And dnspy can only run under Win, so even if it is a mac version dll,
You also have to copy the corresponding dll to Win and then modify it.</p> <p>Download <a href="https://github.com/dnSpy/dnSpy/releases" target="_blank" rel="noopener noreferrer">dnspy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, select <a href="https://github.com/dnSpy/dnSpy/releases/download/v6.1.8/dnSpy-net-win64.zip" target="_blank" rel="noopener noreferrer">Win64 version<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The operation of modifying the dll is roughly as follows:</p> <ul><li>Clear all dlls on the left in dnspy</li> <li>open dll</li> <li>Find the function you want to modify <code>ToModifiedType.ToModifiedMethod</code> function, right-click the menu -&gt; Edit Method (c#)..., and the source code editing interface will pop up.</li> <li>If the editor prompts that some dll references are missing, click the button similar to a folder in the lower left corner of the source code editing window to add them.</li> <li>modify the code</li> <li>Click the <code>Compile</code> button in the lower right corner. If it is successful, there will be no prompt, exit the editing interface, and return to the decompilation viewing mode. If that fails, handle compilation errors yourself. Sometimes dnspy will have inexplicable reference errors, exit the source code editing mode, right-click <code>edit method</code> again, and enter again to solve it.</li> <li>Menu <code>File -&gt; Save Module</code> to save the modified dll file. If under Win or Mac, you may encounter permission problems, please handle it accordingly (for example, save it to another location first, and then manually overwrite it)</li></ul> <h2 id="unityeditor-coremodule-dll"><a href="#unityeditor-coremodule-dll" class="header-anchor">#</a> UnityEditor.CoreModule.dll</h2> <p>Only developers who need to build iOS in version 2021 need to use the modified version of UnityEditor.CoreModule.dll.</p> <h3 id="principle"><a href="#principle" class="header-anchor">#</a> Principle</h3> <p>The <code>HomologousImageMode::Consistent</code> mode of the <code>Supplementary Metadata</code> technology needs to use the cropped AOT dll. At this time, we need to obtain the AOT dll generated during the packaging process.</p> <p>For Unity 2020 and earlier versions, copy out the trimmed AOT dll in the <code>IIl2CppProcessor.OnBeforeConvertRun</code> event.</p> <p>For the Unity 2021 version, targets other than iOS can copy the AOT dll in the <code>IPostprocessBuildWithReport.OnPostprocessBuild</code> event.</p> <p>But when the target is iOS, the clipping output directory is very different from others, it is <code>Temp/StagingArea/Data/Managed/tempStrip</code>, and Unity will delete this temporary directory after converting to c++ code.</p> <p>Unity Editor does not provide a public interface to copy the AOT dll when the target is iOS, so you can only modify the code of UnityEditor.CoreModule.dll. After generating and cutting the AOT dll, insert the appropriate code and copy the corresponding dll to <code>HybridCLRData\AssembliesPostIl2CppStrip \iOS</code>, for subsequent packaging.</p> <p>The UnityEditor.CoreModule.dll code is different for each Unity version. Due to our limited time, only versions 2021.3.1 and 2021.3.6 are currently available (more may be provided in the future), please make other versions yourself. See the section <code>Modify UnityEditor.CoreModule.dll</code> for the specific operation method.</p> <p>Notice! The same version of Win and Mac version of UnityEditor.CoreModule.dll cannot be mixed and must be produced separately.</p> <h3 id="replace-the-original-unityeditor-coremodule-dll"><a href="#replace-the-original-unityeditor-coremodule-dll" class="header-anchor">#</a> Replace the original UnityEditor.CoreModule.dll</h3> <ul><li>Back up <code>{Editor installation directory}/Editor/Data/Managed/UnityEngine/UnityEditor.CoreModule.dll</code> in advance. The specific location of UnityEditor.CoreModule.dll may vary depending on the operating system or Unity version.</li> <li>If you happen to be using a version of 2021.3.1 that already provides a prepared dll, use <code>com.focus-creative-games.hybridclr_unity/Datas~/ModifiedUnityAssemblies/{version}/UnityEditor.CoreModule-{Win,MAC} .dll</code> overrides UnityEditor.CoreModule.dll in the Editor installation directory.</li></ul> <h3 id="modify-with-dnspy"><a href="#modify-with-dnspy" class="header-anchor">#</a> Modify with dnspy</h3> <p>Before performing the following operations, you should carefully read the previous section <code>Using the dnspy tool</code>.</p> <ul><li>Copy the <code>{Editor installation directory}/Editor/Data/Managed/UnityEngine</code> directory, assuming it is the TempUnityEngine directory</li> <li>Delete all .pdb type debug files under the TempUnityEngine directory. <strong>Because there is a problem with Unity's pdb file, it will cause dnspy parsing errors, resulting in failure to save.</strong></li> <li>Open dnspy, clear the dll list on the left.</li> <li>Open <code>TempUnityEngine/UnityEditor.CoreModule.dll</code> with dnspy</li> <li>Open the <code>UnityEditorInternal.AssemblyStripper.RunAssemblyStripper</code> function, right-click menu -&gt; Edit method (c#)..., and the source code editing interface will pop up.</li> <li>At this time, the editor lacks the reference of mscorlib.dll, which needs to be added manually. Click the button similar to the folder in the lower left corner of the source code editing window, and add <code>{Editor installation directory}/Editor/Data/UnityReferenceAssemblies/unity-4.8-api/mscorlib.dll</code>.</li> <li>At the end of the <code>RunAssemblyStripper</code> function, find this code block</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>	<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text3 <span class="token keyword">in</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		File<span class="token punctuation">.</span><span class="token function">Move</span><span class="token punctuation">(</span>text3<span class="token punctuation">,</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>managedAssemblyFolderPath<span class="token punctuation">,</span> Path<span class="token punctuation">.</span><span class="token function">GetFileName</span><span class="token punctuation">(</span>text3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>修改为</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>	<span class="token class-name"><span class="token keyword">string</span></span> dstAOTDir <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>UnityEngine<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>dataPath<span class="token punctuation">,</span> <span class="token string">&quot;../HybridCLRData/AssembliesPostIl2CppStrip&quot;</span><span class="token punctuation">,</span> EditorUserBuildSettings<span class="token punctuation">.</span>activeBuildTarget<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>dstAOTDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text3 <span class="token keyword">in</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>text3<span class="token punctuation">.</span><span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token string">&quot;.dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token class-name"><span class="token keyword">string</span></span> copyDstFile <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>dstAOTDir<span class="token punctuation">,</span> Path<span class="token punctuation">.</span><span class="token function">GetFileName</span><span class="token punctuation">(</span>text3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			File<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>text3<span class="token punctuation">,</span> copyDstFile<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			UnityEngine<span class="token punctuation">.</span>Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">&quot;[RunAssemblyStripper] copy aot dll &quot;</span> <span class="token operator">+</span> text3 <span class="token operator">+</span> <span class="token string">&quot; -&gt; &quot;</span> <span class="token operator">+</span> copyDstFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		File<span class="token punctuation">.</span><span class="token function">Move</span><span class="token punctuation">(</span>text3<span class="token punctuation">,</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>managedAssemblyFolderPath<span class="token punctuation">,</span> Path<span class="token punctuation">.</span><span class="token function">GetFileName</span><span class="token punctuation">(</span>text3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>Note! In the decompiled code, the variable name may not be text3, please handle it according to the actual situation. If you encounter a compilation error, please handle it at your own discretion.</li> <li>Click the <code>Compile</code> button in the lower right corner. If it is successful, there will be no prompt, exit the editing interface, and return to the decompilation viewing mode. If that fails, handle compilation errors yourself. Sometimes dnspy will have inexplicable reference errors, exit the source code editing mode, right-click <code>edit method</code> again, and enter again to solve it.</li> <li>Menu <code>File -&gt; Save Module</code> to save the modified UnityEditor.CoreModule.dll file. If under Win or Mac, you may encounter permission problems, please handle it accordingly (for example, save it to another location first, and then manually overwrite it)</li> <li>Reopen the Unity Editor. At this point iOS can correctly get the cropped AOT dll.</li></ul> <h2 id="unity-il2cpp-dll"><a href="#unity-il2cpp-dll" class="header-anchor">#</a> Unity.IL2CPP.dll</h2> <h3 id="principle-2"><a href="#principle-2" class="header-anchor">#</a> Principle</h3> <p>In the 2019 version, we need to slightly modify the code generated by il2cpp, and replace the constant const Il2CppType defined in <code>Il2CppOutputProject\Source\il2cppOutput\Il2CppTypeDefinitions.c</code> with a variable Il2CppType. We need to modify the <code>Unity.IL2CPP.dll</code> code to achieve this goal.</p> <p>Notice! During the actual operation, we found that there was a problem with the decompiled code of dnspy. Finally, we adjusted the code based on the decompiled code of ILSpy, and then edited and saved it in dnspy.</p> <p>Directly copy the modified code below, edit and save it in dnspy. The modification process may encounter problems, refer to the solution used in modifying <code>UnityEditor.CoreModule.dll</code> above.</p> <h3 id="unity-il2cpp-cppdeclarationswriter-write-streamwriter-writer-icppdeclarations-declarationsin-iinteropdatacollector-interopdatacollector"><a href="#unity-il2cpp-cppdeclarationswriter-write-streamwriter-writer-icppdeclarations-declarationsin-iinteropdatacollector-interopdatacollector" class="header-anchor">#</a> Unity.IL2CPP.CppDeclarationsWriter::Write(StreamWriter writer, ICppDeclarations declarationsIn, IInteropDataCollector interopDataCollector)</h3> <p>modified code</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>     <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> includesToSkip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;\&quot;il2cpp-config.h\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;alloca.h&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;malloc.h&gt;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    CppDeclarationsCollector<span class="token punctuation">.</span><span class="token function">PopulateCache</span><span class="token punctuation">(</span>declarationsIn<span class="token punctuation">.</span>TypeIncludes<span class="token punctuation">,</span> cache<span class="token punctuation">,</span> interopDataCollector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HashSet<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">&gt;</span></span> hashSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HashSet<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>declarationsIn<span class="token punctuation">.</span>TypeIncludes<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeReferenceEqualityComparer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ReadOnlyHashSet<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">&gt;</span></span> dependencies <span class="token operator">=</span> CppDeclarationsCollector<span class="token punctuation">.</span><span class="token function">GetDependencies</span><span class="token punctuation">(</span>declarationsIn<span class="token punctuation">.</span>TypeIncludes<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    hashSet<span class="token punctuation">.</span><span class="token function">UnionWith</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ReadOnlyCollection<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">&gt;</span></span> readOnlyCollection <span class="token operator">=</span> hashSet<span class="token punctuation">.</span><span class="token function">ToSortedCollection</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CppIncludeDepthComparer</span><span class="token punctuation">(</span>comparer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CppDeclarations</span> cppDeclarations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CppDeclarations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cppDeclarations<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>declarationsIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">TypeReference</span> item <span class="token keyword">in</span> readOnlyCollection<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        cppDeclarations<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">GetDeclarations</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> rawFileLevelPreprocessorStmt <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>RawFileLevelPreprocessorStmts<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>rawFileLevelPreprocessorStmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> item2 <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>Includes<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>includesToSkip<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;#include {0}&quot;</span><span class="token punctuation">,</span> item2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> item3 <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>Includes<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>includesToSkip<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>i<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;#include {0}&quot;</span><span class="token punctuation">,</span> item3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">WriteVirtualMethodDeclaration</span><span class="token punctuation">(</span>writer<span class="token punctuation">,</span> cppDeclarations<span class="token punctuation">.</span>VirtualMethods<span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">TypeReference</span> item4 <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>ForwardDeclarations<span class="token punctuation">.</span><span class="token function">ToSortedCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item4<span class="token punctuation">.</span><span class="token function">IsSystemObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>item4<span class="token punctuation">.</span><span class="token function">IsSystemArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>CodeGenOptions<span class="token punctuation">.</span>EmitComments<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Emit<span class="token punctuation">.</span><span class="token function">Comment</span><span class="token punctuation">(</span>item4<span class="token punctuation">.</span>FullName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;struct {0};&quot;</span><span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForType</span><span class="token punctuation">(</span>item4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> item5 <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>RawTypeForwardDeclarations<span class="token punctuation">.</span><span class="token function">ToSortedCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>item5 <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ArrayType</span> item6 <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>ArrayTypes<span class="token punctuation">.</span><span class="token function">ToSortedCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;struct {0};&quot;</span><span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForType</span><span class="token punctuation">(</span>item6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;IL2CPP_EXTERN_C_BEGIN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">TypeReference</span> typeExtern <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>TypeExterns<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;extern Il2CppType &quot;</span> <span class="token operator">+</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForIl2CppType</span><span class="token punctuation">(</span>typeExtern<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">IList<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">&gt;</span></span> genericInstExtern <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>GenericInstExterns<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;extern Il2CppGenericInst &quot;</span> <span class="token operator">+</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForGenericInst</span><span class="token punctuation">(</span>genericInstExtern<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">TypeReference</span> genericClassExtern <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>GenericClassExterns<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;extern Il2CppGenericClass &quot;</span> <span class="token operator">+</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForGenericClass</span><span class="token punctuation">(</span>genericClassExtern<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;IL2CPP_EXTERN_C_END&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>readOnlyCollection<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteClangWarningDisables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">TypeReference</span> item7 <span class="token keyword">in</span> readOnlyCollection<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">string</span></span> source <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetSource</span><span class="token punctuation">(</span>item7<span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteClangWarningEnables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ArrayType</span> arrayType <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>ArrayTypes<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        TypeDefinitionWriter<span class="token punctuation">.</span><span class="token function">WriteArrayTypeDefinition</span><span class="token punctuation">(</span>arrayType<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CodeWriter</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> rawMethodForwardDeclaration <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>RawMethodForwardDeclarations<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>rawMethodForwardDeclaration <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MethodReference</span> sharedMethod <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>SharedMethods<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">WriteSharedMethodDeclaration</span><span class="token punctuation">(</span>writer<span class="token punctuation">,</span> sharedMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MethodReference</span> method <span class="token keyword">in</span> cppDeclarations<span class="token punctuation">.</span>Methods<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">WriteMethodDeclaration</span><span class="token punctuation">(</span>writer<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    writer<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br></div></div><h3 id="unity-il2cpp-il2cpptypewriter-writeil2cpptypedefinitions-imetadatacollection-metadatacollection"><a href="#unity-il2cpp-il2cpptypewriter-writeil2cpptypedefinitions-imetadatacollection-metadatacollection" class="header-anchor">#</a> Unity.IL2CPP.Il2CppTypeWriter::WriteIl2CppTypeDefinitions(IMetadataCollection metadataCollection)</h3> <p>modified code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>    <span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">AddCodeGenMetadataIncludes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IDictionary<span class="token punctuation">&lt;</span>Il2CppTypeData<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> Globals<span class="token punctuation">.</span>Il2CppTypeCollectorReader<span class="token punctuation">.</span>Items<span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">IGrouping<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">,</span> Il2CppTypeData<span class="token punctuation">&gt;</span></span> item <span class="token keyword">in</span> items<span class="token punctuation">.</span>Keys<span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Il2CppTypeData</span> entry<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> entry<span class="token punctuation">.</span>Type<span class="token punctuation">.</span><span class="token function">GetNonPinnedAndNonByReferenceType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeReferenceEqualityComparer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TypeReference</span> key <span class="token operator">=</span> item<span class="token punctuation">.</span>Key<span class="token punctuation">;</span>
        <span class="token class-name">GenericParameter</span> genericParameter <span class="token operator">=</span> key <span class="token keyword">as</span> <span class="token class-name">GenericParameter</span><span class="token punctuation">;</span>
        <span class="token class-name">GenericInstanceType</span> genericInstanceType <span class="token operator">=</span> key <span class="token keyword">as</span> <span class="token class-name">GenericInstanceType</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayType</span> arrayType <span class="token operator">=</span> key <span class="token keyword">as</span> <span class="token class-name">ArrayType</span><span class="token punctuation">;</span>
        <span class="token class-name">PointerType</span> pointerType <span class="token operator">=</span> key <span class="token keyword">as</span> <span class="token class-name">PointerType</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>genericParameter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token punctuation">(</span><span class="token string">&quot;(void*)&quot;</span> <span class="token operator">+</span> metadataCollection<span class="token punctuation">.</span><span class="token function">GetGenericParameterIndex</span><span class="token punctuation">(</span>genericParameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>genericInstanceType <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token function">WriteGenericInstanceTypeDataValue</span><span class="token punctuation">(</span>genericInstanceType<span class="token punctuation">,</span> metadataCollection<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>arrayType <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token function">WriteArrayDataValue</span><span class="token punctuation">(</span>arrayType<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pointerType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token punctuation">(</span><span class="token string">&quot;(void*)&quot;</span> <span class="token operator">+</span> metadataCollection<span class="token punctuation">.</span><span class="token function">GetTypeInfoIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>CultureInfo<span class="token punctuation">.</span>InvariantCulture<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">WritePointerDataValue</span><span class="token punctuation">(</span>pointerType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Il2CppTypeData</span> item2 <span class="token keyword">in</span> item<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;extern Il2CppType {0};&quot;</span><span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForIl2CppType</span><span class="token punctuation">(</span>item2<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> item2<span class="token punctuation">.</span>Attrs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Il2CppType {0} = {{ {1}, {2}, {3}, {4}, {5}, {6} }};&quot;</span><span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForIl2CppType</span><span class="token punctuation">(</span>item2<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> item2<span class="token punctuation">.</span>Attrs<span class="token punctuation">)</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> item2<span class="token punctuation">.</span>Attrs<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>CultureInfo<span class="token punctuation">.</span>InvariantCulture<span class="token punctuation">)</span><span class="token punctuation">,</span> Il2CppTypeSupport<span class="token punctuation">.</span><span class="token function">For</span><span class="token punctuation">(</span>item2<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> item2<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>IsByReference <span class="token punctuation">?</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> item2<span class="token punctuation">.</span>Type<span class="token punctuation">.</span>IsPinned <span class="token punctuation">?</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> MetadataWriter<span class="token punctuation">.</span><span class="token function">WriteTable</span><span class="token punctuation">(</span><span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> <span class="token string">&quot;const Il2CppType* const &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;g_Il2CppTypeTable&quot;</span><span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">ItemsSortedByValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">KeyValuePair<span class="token punctuation">&lt;</span>Il2CppTypeData<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> kvp<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;&amp;&quot;</span> <span class="token operator">+</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForIl2CppType</span><span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Attrs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">externTable</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="unity-il2cpp-metadata-il2cppgenericinstwriter-writeil2cppgenericinstdefinitions-iil2cppgenericinstcollectorreaderservice-genericinstcollection"><a href="#unity-il2cpp-metadata-il2cppgenericinstwriter-writeil2cppgenericinstdefinitions-iil2cppgenericinstcollectorreaderservice-genericinstcollection" class="header-anchor">#</a> Unity.IL2CPP.Metadata.Il2CppGenericInstWriter::WriteIl2CppGenericInstDefinitions(IIl2CppGenericInstCollectorReaderService genericInstCollection)</h3> <p>modified code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">AddCodeGenMetadataIncludes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">TypeReference<span class="token punctuation">[</span><span class="token punctuation">]</span></span> item <span class="token keyword">in</span> genericInstCollection<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token keyword">delegate</span><span class="token punctuation">(</span><span class="token class-name">KeyValuePair<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">&gt;</span></span> item<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">KeyValuePair<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">&gt;</span></span> keyValuePair <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyValuePair<span class="token punctuation">.</span>Key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> item<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">WriteExternForIl2CppType</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name"><span class="token keyword">string</span></span> format <span class="token operator">=</span> <span class="token string">&quot;static const Il2CppType* {0}[] = {{ {1} }};&quot;</span><span class="token punctuation">;</span>
        <span class="token function">WriteLine</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForGenericInst</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;_Types&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TypeReference</span> t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MetadataWriter<span class="token punctuation">.</span><span class="token function">TypeRepositoryTypeFor</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AggregateWithComma</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;extern Il2CppGenericInst {0};&quot;</span><span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForGenericInst</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Il2CppGenericInst {0} = {{ {1}, {2} }};&quot;</span><span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForGenericInst</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>Length<span class="token punctuation">,</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForGenericInst</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;_Types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> MetadataWriter<span class="token punctuation">.</span><span class="token function">WriteTable</span><span class="token punctuation">(</span><span class="token keyword">base</span><span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> <span class="token string">&quot;const Il2CppGenericInst* const&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;g_Il2CppGenericInstTable&quot;</span><span class="token punctuation">,</span> genericInstCollection<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">ItemsSortedByValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">KeyValuePair<span class="token punctuation">&lt;</span>TypeReference<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">uint</span><span class="token punctuation">&gt;</span></span> item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;&amp;&quot;</span> <span class="token operator">+</span> Globals<span class="token punctuation">.</span>Naming<span class="token punctuation">.</span><span class="token function">ForGenericInst</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>Key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">externTable</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2023/05/04, 11:48:51</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/en/hybridclr/hybridclr_unity/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Introduce hybridclr_unity Package</div></a> <a href="/en/hybridclr/code_striping/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Code clipping problem</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/en/hybridclr/hybridclr_unity/" class="prev">Introduce hybridclr_unity Package</a></span> <span class="next"><a href="/en/hybridclr/code_striping/">Code clipping problem</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/hybridclr/project_settings/"><div>
            项目设置
            <!----></div></a> <span class="date">09-29</span></dt></dl><dl><dd>02</dd> <dt><a href="/hybridclr/load_assembly/"><div>
            加载和使用热更新代码
            <!----></div></a> <span class="date">09-29</span></dt></dl><dl><dd>03</dd> <dt><a href="/hybridclr/build_game/"><div>
            打包
            <!----></div></a> <span class="date">09-29</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:hybridclr@code-philosophy.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/focus-creative-games" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>focus-creative-games</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.12d5fdbe.js" defer></script><script src="/assets/js/2.0771a7ec.js" defer></script><script src="/assets/js/113.fc2f8b72.js" defer></script><script src="/assets/js/3.8d0c7075.js" defer></script>
  </body>
</html>
