<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>hybridclr_unity package介绍 | Code Philosophy</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.png">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="Code Philosophy是一个业内领先的专注于提供游戏行业深度技术解决方案的创新型公司。">
    <meta name="keywords" content="HybridCLR,luban,热更新,配表,配置,游戏,git,github">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.de16ca54.css" as="style"><link rel="preload" href="/assets/js/app.12d5fdbe.js" as="script"><link rel="preload" href="/assets/js/2.0771a7ec.js" as="script"><link rel="preload" href="/assets/js/41.703948ac.js" as="script"><link rel="preload" href="/assets/js/3.8d0c7075.js" as="script"><link rel="prefetch" href="/assets/js/10.d15b8a0c.js"><link rel="prefetch" href="/assets/js/100.59f432fb.js"><link rel="prefetch" href="/assets/js/101.3de7bbde.js"><link rel="prefetch" href="/assets/js/102.4a0758d3.js"><link rel="prefetch" href="/assets/js/103.26383b9f.js"><link rel="prefetch" href="/assets/js/104.a1da4ecb.js"><link rel="prefetch" href="/assets/js/105.ef6a6e83.js"><link rel="prefetch" href="/assets/js/106.da96dd79.js"><link rel="prefetch" href="/assets/js/107.ec48bd70.js"><link rel="prefetch" href="/assets/js/108.0f684202.js"><link rel="prefetch" href="/assets/js/109.2a494194.js"><link rel="prefetch" href="/assets/js/11.764b6824.js"><link rel="prefetch" href="/assets/js/110.84415013.js"><link rel="prefetch" href="/assets/js/111.b2685030.js"><link rel="prefetch" href="/assets/js/112.d97b1c0a.js"><link rel="prefetch" href="/assets/js/113.fc2f8b72.js"><link rel="prefetch" href="/assets/js/114.389fdf76.js"><link rel="prefetch" href="/assets/js/115.d7da7753.js"><link rel="prefetch" href="/assets/js/116.7ba543d5.js"><link rel="prefetch" href="/assets/js/117.d7087ed2.js"><link rel="prefetch" href="/assets/js/118.afcabf3e.js"><link rel="prefetch" href="/assets/js/119.2bcae880.js"><link rel="prefetch" href="/assets/js/12.8d2b0d29.js"><link rel="prefetch" href="/assets/js/120.e7473c03.js"><link rel="prefetch" href="/assets/js/121.e7f1865f.js"><link rel="prefetch" href="/assets/js/122.1ee03f15.js"><link rel="prefetch" href="/assets/js/123.8c8de603.js"><link rel="prefetch" href="/assets/js/124.1c8fa702.js"><link rel="prefetch" href="/assets/js/125.92167af0.js"><link rel="prefetch" href="/assets/js/126.d729738c.js"><link rel="prefetch" href="/assets/js/127.291f69f0.js"><link rel="prefetch" href="/assets/js/128.08210df8.js"><link rel="prefetch" href="/assets/js/129.40b77886.js"><link rel="prefetch" href="/assets/js/13.e0289cd0.js"><link rel="prefetch" href="/assets/js/130.8305c052.js"><link rel="prefetch" href="/assets/js/131.5e6ae27f.js"><link rel="prefetch" href="/assets/js/132.d9c12ddc.js"><link rel="prefetch" href="/assets/js/133.82886760.js"><link rel="prefetch" href="/assets/js/134.6f64a5d9.js"><link rel="prefetch" href="/assets/js/135.b90b8356.js"><link rel="prefetch" href="/assets/js/136.24e466af.js"><link rel="prefetch" href="/assets/js/137.aaf435ae.js"><link rel="prefetch" href="/assets/js/138.00c60cde.js"><link rel="prefetch" href="/assets/js/139.14e869b2.js"><link rel="prefetch" href="/assets/js/14.81465e75.js"><link rel="prefetch" href="/assets/js/140.de231325.js"><link rel="prefetch" href="/assets/js/141.4ad5ea60.js"><link rel="prefetch" href="/assets/js/142.f36e159e.js"><link rel="prefetch" href="/assets/js/143.2e4611d8.js"><link rel="prefetch" href="/assets/js/144.e9ebb3fa.js"><link rel="prefetch" href="/assets/js/145.1a9f5fad.js"><link rel="prefetch" href="/assets/js/146.624849a0.js"><link rel="prefetch" href="/assets/js/147.461906c5.js"><link rel="prefetch" href="/assets/js/148.d28d7aaa.js"><link rel="prefetch" href="/assets/js/149.9784b5ed.js"><link rel="prefetch" href="/assets/js/15.6b1ebda0.js"><link rel="prefetch" href="/assets/js/150.240e44d2.js"><link rel="prefetch" href="/assets/js/151.604089c9.js"><link rel="prefetch" href="/assets/js/152.f73b8be0.js"><link rel="prefetch" href="/assets/js/153.e16a3cbb.js"><link rel="prefetch" href="/assets/js/16.9f462aa4.js"><link rel="prefetch" href="/assets/js/17.f6132239.js"><link rel="prefetch" href="/assets/js/18.a0728471.js"><link rel="prefetch" href="/assets/js/19.647597ef.js"><link rel="prefetch" href="/assets/js/20.113a110f.js"><link rel="prefetch" href="/assets/js/21.e8949420.js"><link rel="prefetch" href="/assets/js/22.715d702b.js"><link rel="prefetch" href="/assets/js/23.0c731f9a.js"><link rel="prefetch" href="/assets/js/24.83715717.js"><link rel="prefetch" href="/assets/js/25.a6efb8d9.js"><link rel="prefetch" href="/assets/js/26.876b7bf2.js"><link rel="prefetch" href="/assets/js/27.7e6a1fbc.js"><link rel="prefetch" href="/assets/js/28.c9603a98.js"><link rel="prefetch" href="/assets/js/29.7a6ffd69.js"><link rel="prefetch" href="/assets/js/30.bbdcda14.js"><link rel="prefetch" href="/assets/js/31.441495f6.js"><link rel="prefetch" href="/assets/js/32.516dc27e.js"><link rel="prefetch" href="/assets/js/33.796a4638.js"><link rel="prefetch" href="/assets/js/34.b844a239.js"><link rel="prefetch" href="/assets/js/35.4489eede.js"><link rel="prefetch" href="/assets/js/36.4944cc18.js"><link rel="prefetch" href="/assets/js/37.2b295b6f.js"><link rel="prefetch" href="/assets/js/38.c7f25fa6.js"><link rel="prefetch" href="/assets/js/39.f350b082.js"><link rel="prefetch" href="/assets/js/4.e8f1cdb3.js"><link rel="prefetch" href="/assets/js/40.6346e1bc.js"><link rel="prefetch" href="/assets/js/42.cb158675.js"><link rel="prefetch" href="/assets/js/43.a6366a4f.js"><link rel="prefetch" href="/assets/js/44.67b267cd.js"><link rel="prefetch" href="/assets/js/45.d9ded0f6.js"><link rel="prefetch" href="/assets/js/46.dce204c1.js"><link rel="prefetch" href="/assets/js/47.f59b1714.js"><link rel="prefetch" href="/assets/js/48.e72d5a9a.js"><link rel="prefetch" href="/assets/js/49.57c226c6.js"><link rel="prefetch" href="/assets/js/5.765a6984.js"><link rel="prefetch" href="/assets/js/50.696d3556.js"><link rel="prefetch" href="/assets/js/51.f9fcee2c.js"><link rel="prefetch" href="/assets/js/52.e8d8f311.js"><link rel="prefetch" href="/assets/js/53.cb8fbe86.js"><link rel="prefetch" href="/assets/js/54.4df421a2.js"><link rel="prefetch" href="/assets/js/55.5a9cb469.js"><link rel="prefetch" href="/assets/js/56.7e073255.js"><link rel="prefetch" href="/assets/js/57.6756691b.js"><link rel="prefetch" href="/assets/js/58.9d1c4a46.js"><link rel="prefetch" href="/assets/js/59.a560b055.js"><link rel="prefetch" href="/assets/js/6.ddf0c9b8.js"><link rel="prefetch" href="/assets/js/60.a23590d0.js"><link rel="prefetch" href="/assets/js/61.5b3a43f9.js"><link rel="prefetch" href="/assets/js/62.72a56b46.js"><link rel="prefetch" href="/assets/js/63.ceded64f.js"><link rel="prefetch" href="/assets/js/64.f26c8cb9.js"><link rel="prefetch" href="/assets/js/65.fb45c073.js"><link rel="prefetch" href="/assets/js/66.83ebce20.js"><link rel="prefetch" href="/assets/js/67.eff63cf4.js"><link rel="prefetch" href="/assets/js/68.8bb955ae.js"><link rel="prefetch" href="/assets/js/69.dae7cec8.js"><link rel="prefetch" href="/assets/js/7.32660699.js"><link rel="prefetch" href="/assets/js/70.20e84c9c.js"><link rel="prefetch" href="/assets/js/71.6c135456.js"><link rel="prefetch" href="/assets/js/72.a6cef57b.js"><link rel="prefetch" href="/assets/js/73.ea109d55.js"><link rel="prefetch" href="/assets/js/74.31bd4677.js"><link rel="prefetch" href="/assets/js/75.e90da937.js"><link rel="prefetch" href="/assets/js/76.74f061bb.js"><link rel="prefetch" href="/assets/js/77.4a1bfa57.js"><link rel="prefetch" href="/assets/js/78.7847ecac.js"><link rel="prefetch" href="/assets/js/79.5fa65e36.js"><link rel="prefetch" href="/assets/js/8.62b0d450.js"><link rel="prefetch" href="/assets/js/80.008f19fa.js"><link rel="prefetch" href="/assets/js/81.e245ac7c.js"><link rel="prefetch" href="/assets/js/82.8f5a662c.js"><link rel="prefetch" href="/assets/js/83.cc9a1992.js"><link rel="prefetch" href="/assets/js/84.dcf087c6.js"><link rel="prefetch" href="/assets/js/85.be5afefb.js"><link rel="prefetch" href="/assets/js/86.97d6599a.js"><link rel="prefetch" href="/assets/js/87.1df10b08.js"><link rel="prefetch" href="/assets/js/88.f5a3d153.js"><link rel="prefetch" href="/assets/js/89.1a78c9ca.js"><link rel="prefetch" href="/assets/js/9.f51c0ef6.js"><link rel="prefetch" href="/assets/js/90.dfb15931.js"><link rel="prefetch" href="/assets/js/91.a5bdf350.js"><link rel="prefetch" href="/assets/js/92.4d4d7050.js"><link rel="prefetch" href="/assets/js/93.4ce8faaa.js"><link rel="prefetch" href="/assets/js/94.13bd2ab5.js"><link rel="prefetch" href="/assets/js/95.f941715f.js"><link rel="prefetch" href="/assets/js/96.6adeb803.js"><link rel="prefetch" href="/assets/js/97.6e1aaaf3.js"><link rel="prefetch" href="/assets/js/98.53de0dca.js"><link rel="prefetch" href="/assets/js/99.6f94e8b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.de16ca54.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Code Philosophy" class="logo"> <span class="site-name can-hide">Code Philosophy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HybridCLR文档" class="dropdown-title"><a href="/hybridclr/index/" class="link-title">HybridCLR文档</a> <span class="title" style="display:none;">HybridCLR文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hybridclr/about/" class="nav-link">关于HybridCLR</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/start_up/" class="nav-link">快速开始</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/install/" class="nav-link">安装</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/benchmark/" class="nav-link">性能报告</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/faq/" class="nav-link">FAQ</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/common_errors/" class="nav-link">常见错误处理</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/bug_reporter/" class="nav-link">bug反馈</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Luban文档" class="dropdown-title"><a href="/luban/index/" class="link-title">Luban文档</a> <span class="title" style="display:none;">Luban文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/luban/about/" class="nav-link">关于luban</a></li><li class="dropdown-item"><!----> <a href="/luban/start_up/" class="nav-link">快速开始</a></li><li class="dropdown-item"><!----> <a href="/luban/command_tools/" class="nav-link">完整特性</a></li><li class="dropdown-item"><!----> <a href="/luban/data_source/" class="nav-link">多数据源</a></li><li class="dropdown-item"><!----> <a href="/luban/advanced/validator/" class="nav-link">高级特性</a></li><li class="dropdown-item"><!----> <a href="/luban/tools/" class="nav-link">Luban工具</a></li></ul></div></div><div class="nav-item"><a href="/hybridclr/price/" class="nav-link">商业化支持</a></div><div class="nav-item"><a href="/join/" class="nav-link">招聘</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><!----> <span class="title" style="display:;">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hybridclr/hybridclr_unity/" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/hybridclr_unity/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/focus-creative-games" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HybridCLR文档" class="dropdown-title"><a href="/hybridclr/index/" class="link-title">HybridCLR文档</a> <span class="title" style="display:none;">HybridCLR文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hybridclr/about/" class="nav-link">关于HybridCLR</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/start_up/" class="nav-link">快速开始</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/install/" class="nav-link">安装</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/benchmark/" class="nav-link">性能报告</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/faq/" class="nav-link">FAQ</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/common_errors/" class="nav-link">常见错误处理</a></li><li class="dropdown-item"><!----> <a href="/hybridclr/bug_reporter/" class="nav-link">bug反馈</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Luban文档" class="dropdown-title"><a href="/luban/index/" class="link-title">Luban文档</a> <span class="title" style="display:none;">Luban文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/luban/about/" class="nav-link">关于luban</a></li><li class="dropdown-item"><!----> <a href="/luban/start_up/" class="nav-link">快速开始</a></li><li class="dropdown-item"><!----> <a href="/luban/command_tools/" class="nav-link">完整特性</a></li><li class="dropdown-item"><!----> <a href="/luban/data_source/" class="nav-link">多数据源</a></li><li class="dropdown-item"><!----> <a href="/luban/advanced/validator/" class="nav-link">高级特性</a></li><li class="dropdown-item"><!----> <a href="/luban/tools/" class="nav-link">Luban工具</a></li></ul></div></div><div class="nav-item"><a href="/hybridclr/price/" class="nav-link">商业化支持</a></div><div class="nav-item"><a href="/join/" class="nav-link">招聘</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><!----> <span class="title" style="display:;">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hybridclr/hybridclr_unity/" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/hybridclr/hybridclr_unity/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/focus-creative-games" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/hybridclr/about/" class="sidebar-link">关于HybridCLR</a></li><li><a href="/hybridclr/start_up/" class="sidebar-link">快速上手</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>教程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>原理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hybridclr/build_pipeline/" class="sidebar-link">HybridCLR打包工作流</a></li><li><a href="/hybridclr/monobehaviour/" class="sidebar-link">热更新MonoBehaviour</a></li><li><a href="/hybridclr/build_ios_libil2cpp/" class="sidebar-link">iOS平台打包</a></li><li><a href="/hybridclr/differential_hybrid_execution/" class="sidebar-link">Differential Hybrid Execution</a></li><li><a href="/hybridclr/hotreload/" class="sidebar-link">热重载技术</a></li><li><a href="/hybridclr/hybridclr_unity/" aria-current="page" class="active sidebar-link">hybridclr_unity package介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/hybridclr/hybridclr_unity/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header level2"><a href="/hybridclr/hybridclr_unity/#hybridclr菜单介绍" class="sidebar-link">HybridCLR菜单介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#installer" class="sidebar-link">Installer...</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#compile-dll" class="sidebar-link">Compile Dll</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#generate" class="sidebar-link">Generate</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#linkxml" class="sidebar-link">LinkXml</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#aotdlls" class="sidebar-link">AOTDlls</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#methodbridge" class="sidebar-link">MethodBridge</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#aotgenericreference" class="sidebar-link">AOTGenericReference</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#reversepinvokewrapper" class="sidebar-link">ReversePInvokeWrapper</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#il2cppdef" class="sidebar-link">Il2CppDef</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#dheassemblylist" class="sidebar-link">DHEAssemblyList</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#dheassemblyoptiondatas" class="sidebar-link">DHEAssemblyOptionDatas</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#all" class="sidebar-link">All</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hybridclr/hybridclr_unity/#hybridclr-配置" class="sidebar-link">HybridCLR 配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#enable" class="sidebar-link">enable</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#useglobalil2cpp" class="sidebar-link">useGlobalIl2cpp</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#hybridclrrepourl" class="sidebar-link">hybridclrRepoURL</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#il2cppplusrepourl" class="sidebar-link">il2cppPlusRepoURL</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#hotupdateassemblydefinitions" class="sidebar-link">hotUpdateAssemblyDefinitions</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#hotupdateassemblies" class="sidebar-link">hotUpdateAssemblies</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#preservehotupdateassemblies" class="sidebar-link">preserveHotUpdateAssemblies</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#hotupdatedllcompileoutputrootdir" class="sidebar-link">hotUpdateDllCompileOutputRootDir</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#externalhotupdateassemblydirs" class="sidebar-link">externalHotUpdateAssemblyDirs</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#strippedaotdlloutputrootdir" class="sidebar-link">strippedAOTDllOutputRootDir</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#patchaotassemblies" class="sidebar-link">patchAOTAssemblies</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#differentialhybridassemblies" class="sidebar-link">differentialHybridAssemblies</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#differentialhybridoptionoutputdir" class="sidebar-link">differentialHybridOptionOutputDir</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#collectassetreferencetypes" class="sidebar-link">collectAssetReferenceTypes</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#outputlinkfile" class="sidebar-link">outputLinkFile</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#outputaotgenericreferencefile" class="sidebar-link">outputAOTGenericReferenceFile</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#maxgenericreferenceiteration" class="sidebar-link">maxGenericReferenceIteration</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#maxmethodbridgegenericiteration" class="sidebar-link">maxMethodBridgeGenericIteration</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hybridclr/hybridclr_unity/#editor相关工具" class="sidebar-link">Editor相关工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#初始化hybridclr" class="sidebar-link">初始化HybridCLR</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#检查和修复设置" class="sidebar-link">检查和修复设置</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#打包时自动排除热更新assembly" class="sidebar-link">打包时自动排除热更新assembly</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#打包时将热更新dll名添加到assembly列表" class="sidebar-link">打包时将热更新dll名添加到assembly列表</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#备份裁剪后的aot-dll" class="sidebar-link">备份裁剪后的AOT dll</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#生成一些打包需要的文件和代码" class="sidebar-link">生成一些打包需要的文件和代码</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hybridclr/hybridclr_unity/#iosbuild脚本" class="sidebar-link">iOSBuild脚本</a></li><li class="sidebar-sub-header level2"><a href="/hybridclr/hybridclr_unity/#runtime相关脚本" class="sidebar-link">Runtime相关脚本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#loadimageerrorcode" class="sidebar-link">LoadImageErrorCode</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#元数据模式-homologousimagemode" class="sidebar-link">元数据模式 HomologousImageMode</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#homologousimagemode-consistent-模式" class="sidebar-link">HomologousImageMode::Consistent 模式</a></li><li class="sidebar-sub-header level4"><a href="/hybridclr/hybridclr_unity/#homologousimagemode-superset-模式" class="sidebar-link">HomologousImageMode::SuperSet 模式</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#runtimeapi" class="sidebar-link">RuntimeApi</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#unchangedattribute" class="sidebar-link">UnchangedAttribute</a></li><li class="sidebar-sub-header level3"><a href="/hybridclr/hybridclr_unity/#reversepinvokewrappergenerationattribute" class="sidebar-link">ReversePInvokeWrapperGenerationAttribute</a></li></ul></li></ul></li><li><a href="/hybridclr/modify_unity_dll/" class="sidebar-link">修改Unity编辑器相关dll</a></li><li><a href="/hybridclr/code_striping/" class="sidebar-link">代码裁剪问题</a></li><li><a href="/hybridclr/aot_generic/" class="sidebar-link">AOT泛型问题</a></li><li><a href="/hybridclr/method_bridge/" class="sidebar-link">桥接函数</a></li><li><a href="/hybridclr/memory/" class="sidebar-link">内存占用与GC</a></li><li><a href="/hybridclr/performance/" class="sidebar-link">运行性能</a></li><li><a href="/hybridclr/limit/" class="sidebar-link">限制事项</a></li><li><a href="/hybridclr/work_with_script_language/" class="sidebar-link">HybridCLR+lua/js/python</a></li><li><a href="/hybridclr/monopinvokecallback/" class="sidebar-link">MonoPInvokeCallback支持</a></li><li><a href="/hybridclr/supported_unity_versions/" class="sidebar-link">支持的Unity版本</a></li><li><a href="/hybridclr/supported_platform/" class="sidebar-link">跨平台支持</a></li><li><a href="/hybridclr/source_inspect/" class="sidebar-link">源码与调试</a></li><li><a href="/hybridclr/best_practices/" class="sidebar-link">最佳实践</a></li><li><a href="/hybridclr/129afe/" class="sidebar-link">il2cpp bugs</a></li></ul></section></li><li><a href="/hybridclr/faq/" class="sidebar-link">FAQ</a></li><li><a href="/hybridclr/benchmark/" class="sidebar-link">性能报告</a></li><li><a href="/hybridclr/business_games/" class="sidebar-link">已经上线的商业项目</a></li><li><a href="/hybridclr/common_errors/" class="sidebar-link">常见错误</a></li><li><a href="/hybridclr/bug_reporter/" class="sidebar-link">BUG反馈模板</a></li><li><a href="/hybridclr/recommended-tools/" class="sidebar-link">相关第三方项目</a></li><li><a href="/hybridclr/roadmap/" class="sidebar-link">后续开发规划</a></li><li><a href="/hybridclr/price/" class="sidebar-link">商业化服务</a></li><li><a href="/hybridclr/donate/" class="sidebar-link">致谢</a></li><li><a href="/hybridclr/changelog/" class="sidebar-link">开发事纪</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/hybridclr/hybridclr_unity/hybridclr" data-v-06225672>hybridclr</a></li><li data-v-06225672><a href="/hybridclr/hybridclr_unity/hybridclr/#原理" data-v-06225672>原理</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https:://code-philosophy.com" target="_blank" title="作者" class="beLink" data-v-06225672>Code Philosophy</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-25</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">hybridclr_unity package介绍<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="hybridclr-unity"><a href="#hybridclr-unity" class="header-anchor">#</a> hybridclr_unity</h1> <p>hybridclr_unity是一个Unity package，它提供了HybridCLR所需的Editor工作流工具脚本及Runtime脚本。借助
hybridclr_unity提供的工作流工具，打包一个支持HybridCLR热更新功能的App变得非常简单。</p> <p>hybridclr_unity工具主要包含：</p> <ul><li>Editor相关脚本</li> <li>Runtime相关脚本</li> <li>iOSBuild脚本</li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>从git url安装 <code>com.focus-creative-games.hybridclr_unity</code> <a href="https://gitee.com/focus-creative-games/hybridclr_unity" target="_blank" rel="noopener noreferrer">gitee(推荐)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或<a href="https://github.com/focus-creative-games/hybridclr_unity" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> package。</p> <p>不熟悉从url安装package的请看<a href="https://docs.unity3d.com/Manual/upm-ui-giturl.html" target="_blank" rel="noopener noreferrer">install from giturl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>由于国内网络原因，在unity中可能遇到网络异常而无法安装。你可以先把 <code>com.focus-creative-games.hybridclr_unity</code> clone或者下载到本地，然后再 <a href="https://docs.unity3d.com/Manual/upm-ui-local.html" target="_blank" rel="noopener noreferrer">install from disk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>或者更简单一点的做法，下载到本地后，将仓库文件夹目录改名为<code>com.focus-creative-games.hybridclr_unity</code>，直接复制到你们项目的<code>Packages</code>目录下即可。</p> <h2 id="hybridclr菜单介绍"><a href="#hybridclr菜单介绍" class="header-anchor">#</a> HybridCLR菜单介绍</h2> <h3 id="installer"><a href="#installer" class="header-anchor">#</a> Installer...</h3> <p>提供一个方便的安装器，帮助正确设置本地il2cpp目录，其中包含替换<code>HybridCLRData/LocalIl2CppData-{platform}/il2cpp/libil2cpp</code>目录为HybridCLR修改版本。</p> <p>安装器需要从匹配版本的Unity安装目录复制il2cpp(类似<code>C:\Program Files\Unity\Hub\Editor\2020.3.33f1\Editor\Data\il2cpp</code>)相关文件。</p> <ul><li>对于2019.4.40+、2021.3.26+、2021.3.0+ 版本，直接从该版本的安装目录复制il2cpp文件。</li> <li>对于2020.3.16-2020.3.20版本，需要额外安装2020.3.26或更高版本，使用<code>HybridCLR/Installer</code>安装后再切回当前版本。</li> <li>对于2019.4.0-2019.4.39版本，需要额外安装2019.4.40版本，使用<code>HybridCLR/Installer</code>安装后再切回当前版本。</li></ul> <p>安装界面中 <code>安装状态：已安装|未安装</code> 指示是否完成HybridCLR初始化。</p> <p>安装界面中 <code>il2cpp_plus分支对应的Unity兼容版本的il2cpp路径</code> （<strong>注意！1.1.7版本移除了此设置。</strong>）必须满足几个条件：</p> <ul><li>必须是兼容的unity版本的il2cpp目录</li> <li>路径中必须包含unity版本号（Installer用来识别Unity版本，以及用于防止新手选错目录）</li></ul> <p>如果路径合法，则界面显示正常，否则将会出现红色警告。</p> <p>填写你要安装的hybridclr和il2cpp_plus仓库的branch或tag。如果hybridclr的版本号留空，则安装hybridclr仓库main分支的最新版本。
如果il2cpp_plus的版本号留空，则安装相应年度版本（如2020.3.33）分支的最新版本。</p> <p>点击安装，如成功，则最后会显示<code>安装成功</code>日志，并且安装状态切换为<code>已安装</code>，否则请检查错误日志。</p> <p>如果已经安装HybridCLR，点击安装按钮会安装最新的HybridCLR版本的libil2cpp。</p> <h3 id="compile-dll"><a href="#compile-dll" class="header-anchor">#</a> Compile Dll</h3> <p>对于每个target，必须使用目标平台编译开关下编译出的热更新dll，否则会出现热更新代码与AOT主包或者热更新资源的代码信息不匹配的情况。</p> <p>不匹配时Unity会打印此类日志： <code>A scripted object (probably XXX?) has a different serialization layout when loading. Did you #ifdef UNITY_EDITOR a section of your serialized properties in any of your scripts?</code>。</p> <p>借助Unity的<code>PlayerBuildInterface.CompilePlayerScripts</code>Api，hybridclr_unity提供一个编译各个target对应的热更新dll的编译脚本，编译完成后的热更新dll放到 <code>{project}/HybridCLRData/HotUpdateDlls/{platform}</code> 目录下。</p> <p>开发者灵活选择恰当的方式去使用这些热更新dll。</p> <h3 id="generate"><a href="#generate" class="header-anchor">#</a> Generate</h3> <p>Generate下包含多种生成工具。</p> <h4 id="linkxml"><a href="#linkxml" class="header-anchor">#</a> LinkXml</h4> <p>扫描热更新dll引用的AOT类型，生成link.xml，避免热更新脚本用到的AOT类型或函数被裁剪。输出的文件路径在 HybridCLRSettings.asset中<code>OuputLinkXml</code>字段中指定，默认为<code>LinkGenerator/link.xml</code>。</p> <p>更具体的裁剪相关介绍请看<a href="/hybridclr/code_striping/">代码裁剪原理及解决办法</a>。</p> <h4 id="aotdlls"><a href="#aotdlls" class="header-anchor">#</a> AOTDlls</h4> <p>生成裁剪后的AOT dlls。脚本通过在一个临时目录导出工程，实现生成裁剪后的AOT dlls的目标。</p> <p>注意，如果你没有用 <code>HybridCLR/Generate/All</code> 这样的一键生成命令，在你手动生成裁剪后 AOTDlls 前请先通过 <code>HybridCLR/Generate/LinkXml</code> 生成LinkXml。</p> <h4 id="methodbridge"><a href="#methodbridge" class="header-anchor">#</a> MethodBridge</h4> <p>根据当前的AOT dll集扫描生成桥接函数文件。HybridCLRSettings.asset中<code>maxGenericReferenceIteration</code>字段指定了泛型递归扫描最大迭代轮数。大多数项目取
10以内即可。</p> <p>更具体的桥接函数相关文档请看<a href="/hybridclr/method_bridge/">桥接函数</a>文档。</p> <h4 id="aotgenericreference"><a href="#aotgenericreference" class="header-anchor">#</a> AOTGenericReference</h4> <p>根据当前热更新dll扫描出所有产生的AOT泛型类型及函数的实例化，并生成一个<strong>启发的</strong>泛型实例化文件。</p> <p>HybridCLRSettings.asset中<code>outputAOTGenericReferenceFile</code>字段指定了输出文件路径，<code>maxGenericReferenceIteration</code>字段指定泛型递归扫描的最大迭代次数。</p> <p>由于将扫描出的泛型类型及函数转换为对应的代码引用比较麻烦，生成的所有泛型实例化代码都是<strong>注释代码</strong>，由开发者自己酌情转换为正确的实例化引用（<strong>这个操作是可选的，可以完全不处理或只处理一部分</strong>），即在AOT代码中实例化这注释中的泛型类或泛型函数。方法大致如下：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
    <span class="token comment">// System.Collections.Generics.List`1&lt;System.Object&gt;.ctor</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// System.Byte[] Array.Empty`1&lt;System.Byte&gt;()</span>
    Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>请在其他文件中添加泛型类型及函数的实例化引用，因为这个输出文件每次重新生成后会被覆盖。</p> <p>这个泛型实例化文档只起到启发作用，告诉你可以aot泛型实例化哪些类和函数。使用补充元数据机制后，
<strong>不作任何处理</strong>也不影响正常运行。但如果手动对aot泛型实例化，可以提升性能。建议是对于少量性能敏感的类或函数手动泛型实例化即可，如<code>Dictionary&lt;int,int&gt;</code>之类。</p> <p>更具体的AOT泛型相关文档请看<a href="/hybridclr/aot_generic/">AOT泛型介绍</a>。</p> <h4 id="reversepinvokewrapper"><a href="#reversepinvokewrapper" class="header-anchor">#</a> ReversePInvokeWrapper</h4> <p>为标记了<code>[MonoPInvokeCallback]</code>注解的热更新C#静态函数生成一个 ReversePInvokeWrapper函数。这样每个热更新C#静态函数将有一个唯一对应的c++函数，
可以被用于注册到lua之类的脚本语言中，并且被脚本语言调用。</p> <p>HybridCLRSettings.asset中<code>reversePInvokeWrapperCount</code>字段指示生成的wrapper c++函数的个数，请预留足够多，确保超过热更新C#代码中标记了<code>[MonoPInvokeCallback]</code>注释的C#函数的个数。否则可能会抛出异常。</p> <p>更具体的MonoPInvokeCallback介绍请看文档<a href="/hybridclr/monopinvokecallback/">MonoPInvokeCallback支持</a></p> <h4 id="il2cppdef"><a href="#il2cppdef" class="header-anchor">#</a> Il2CppDef</h4> <p>生成当前Unity版本相关宏定义。类似如下：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>
<span class="token comment">// Il2CppCompatibleDefs.h</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HYBRIDCLR_UNITY_VERSION</span> <span class="token expression"><span class="token number">2020333</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HYBRIDCLR_UNITY_2020</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HYBRIDCLR_UNITY_2019_OR_NEW</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HYBRIDCLR_UNITY_2020_OR_NEW</span> <span class="token expression"><span class="token number">1</span></span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="dheassemblylist"><a href="#dheassemblylist" class="header-anchor">#</a> DHEAssemblyList</h4> <p><strong>DHE版本</strong>专有字段。</p> <p>生成差分混合assembly列表代码。</p> <p>因为HybridCLR需要在il2cpp初始化的阶段对差分混合执行assembly作预处理，目前以生成的assembly列表代码的方式提供给HybridCLR。</p> <p>示例如下:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>    <span class="token comment">// Il2CppCompatibleDefs.cpp 文件</span>

	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> g_differentialHybridAssemblies<span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token punctuation">{</span>

	<span class="token comment">//!!!{{DHE</span>
        <span class="token string">&quot;Assembly-CSharp&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">//!!!}}DHE</span>
		<span class="token keyword">nullptr</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="dheassemblyoptiondatas"><a href="#dheassemblyoptiondatas" class="header-anchor">#</a> DHEAssemblyOptionDatas</h4> <p><strong>DHE版本</strong>专有字段。</p> <p>生成 差分混合assembly的配置数据。</p> <p>加载差分混合执行assembly需要一些配置数据。例如哪些函数发生变化是离线计算好的，这样不需要运行时判定函数是否发生变化了。配置数据在调用<code>RuntimeApi::LoadDifferentialHybridAssembly</code> 作为参数传入。</p> <h4 id="all"><a href="#all" class="header-anchor">#</a> All</h4> <p>一键执行上面4种生成操作。</p> <h2 id="hybridclr-配置"><a href="#hybridclr-配置" class="header-anchor">#</a> HybridCLR 配置</h2> <p>点击菜单 <code>HybridCLR/Settings</code> 打开配置界面。下面是字段详细说明。</p> <h3 id="enable"><a href="#enable" class="header-anchor">#</a> enable</h3> <p>是否开启HyridCLR热更。默认true。如果为false,则打包不再包含HybridCLR功能。</p> <h3 id="useglobalil2cpp"><a href="#useglobalil2cpp" class="header-anchor">#</a> useGlobalIl2cpp</h3> <p>是否使用全局安装位置，即editor安装位置下的il2cpp目录。默认false。一般只有打包WebGL时才需要<code>useGlobalIl2cpp=true</code>。</p> <p>注意，就算 <code>useGlobalIl2Cpp=true</code>，安装时仍然会复制il2cpp到HybridCLRData目录。
需要手动将 <code>{project}/HyridCLRData/LocalIl2CppData-{platform}/il2cpp/libil2cpp</code> 目录替换 editor安装目录下的对应目录。另外运行<code>HybridCLR/Generate/*</code>执行生成操作，输出目录仍然是本地目录，需要自己手动复制替换全局安装位置的libil2cpp目录。</p> <h3 id="hybridclrrepourl"><a href="#hybridclrrepourl" class="header-anchor">#</a> hybridclrRepoURL</h3> <p>hybridclr仓库的地址，默认值为 <code>https://gitee.com/focus-creative-games/hybridclr</code>。</p> <h3 id="il2cppplusrepourl"><a href="#il2cppplusrepourl" class="header-anchor">#</a> il2cppPlusRepoURL</h3> <p>il2cpp_plus 仓库的地址，默认值为 <code>https://gitee.com/focus-creative-games/il2cpp_plus</code>。</p> <h3 id="hotupdateassemblydefinitions"><a href="#hotupdateassemblydefinitions" class="header-anchor">#</a> hotUpdateAssemblyDefinitions</h3> <p>以assembly definition(asmdef) 形式定义的热更新模块列表，它与下面的<code>hotUpdateAssemblies</code>是等效的，只不过编辑器下拖入asmdef模块比较方便，也不容易失误写错名称。</p> <p><code>hotUpdateAssemblyDefinitions</code>和<code>hotUpdateAssemblies</code>合并后构成最终的热更新dll列表。同一个assembly不要在两个列表中同时出现，会报错！</p> <h3 id="hotupdateassemblies"><a href="#hotupdateassemblies" class="header-anchor">#</a> hotUpdateAssemblies</h3> <p>有一些assembly以dll形式存在，例如你在外部工程中创建的热更新dll，又如你直接使用Assembly-CSharp作为你的热更新dll。由于没有对应的asmdef文件，只能以dll名称形式手动配置。</p> <p>填写assembly名称时不要包含'.dll'后缀，像<code>Main</code>、<code>Assembly-CSharp</code>这样即可。</p> <p>asmdef形式的assembly，你也可以选择不加到<code>hotUpdateAssemblyDefinitions</code>，而是加到<code>hotUpdateAssemblies</code>。不过这样不如直接拖入列表方便，你自己酌情选择。</p> <p><code>hotUpdateAssemblyDefinitions</code>和<code>hotUpdateAssemblies</code>合并后构成最终的热更新dll列表。同一个assembly不要在两个列表中同时出现，会报错！</p> <h3 id="preservehotupdateassemblies"><a href="#preservehotupdateassemblies" class="header-anchor">#</a> preserveHotUpdateAssemblies</h3> <p>预留的热更新dll名字列表。有时候想在将来新增一些热更新dll，并且期望这些新的热更新dll的脚本能够挂载到资源上。如果直接将热更新dll名加到 hotUpdateAssemblies则会报assembly不存在的错误。preserveHotUpdateAssemblies字段用来满足这种需求。打包时不检查这些dll的有效性，并且会将它们添加到scriptingassemblies.json之类的assembly列表文件中。</p> <p>填写assembly名称时不要包含'.dll'后缀，像<code>Abc</code>这样即可。</p> <h3 id="hotupdatedllcompileoutputrootdir"><a href="#hotupdatedllcompileoutputrootdir" class="header-anchor">#</a> hotUpdateDllCompileOutputRootDir</h3> <p>编译后的热更新dll的输出根目录。最终输出目录在该目录的平台子目录下，即 <code>${hotUpdateDllCompileOutputRootDir}/{platform}</code>。</p> <h3 id="externalhotupdateassemblydirs"><a href="#externalhotupdateassemblydirs" class="header-anchor">#</a> externalHotUpdateAssemblyDirs</h3> <p>自定义外部热更新dll的搜索路径。有一些框架或项目的热更新项目放到Unity外部，编译出的dll也在外部。这个参数提供了一个热更新dll
的搜索路径，这样不需要每次将外部dll复制到工程里或者复制到 hotUpdateAssemblies 目录了。</p> <ul><li>按搜索路径的顺序搜索，排在越前的优先级越高。</li> <li>搜索路径必须是相对位置，相对于项目根目录（即Assets的<strong>上级目录</strong>）。即填<code>mydir</code>，搜索<code>{proj}/mydir</code>。</li> <li>每个路径<code>dir</code>，会先尝试搜索<code>{dir}/{platform}</code>，再尝试搜索<code>{dir}</code>。这样做为了兼顾平台特殊性及通用性。</li></ul> <p>下面展示一个使用示例。你有一个外部dll，它的位置为 <code>{proj}/MyDir1/MyDir2/Foo.dll</code>，则你应该：</p> <ul><li>在 hotUpdateAssemblies 添加 <code>Foo</code></li> <li>在 externalHotUpdateAssemblyDirs 里添加目录 <code>MyDir1/Mydir2</code></li></ul> <h3 id="strippedaotdlloutputrootdir"><a href="#strippedaotdlloutputrootdir" class="header-anchor">#</a> strippedAOTDllOutputRootDir</h3> <p>裁剪后的AOT dll的暂存目录。最终目录在该目录的平台子目录下，即 <code>${strippedAOTDllOutputRootDir}/{platform}</code>。</p> <h3 id="patchaotassemblies"><a href="#patchaotassemblies" class="header-anchor">#</a> patchAOTAssemblies</h3> <p>补充元数据AOT dll列表。package本身没有用到这个配置项。但它提供了一个配置AOT dll列表的地方，方便开发者在自己的打包流程中使用，这样就不用开发者单独再定义一个AOT dll配置脚本了。</p> <p>填写assembly名称时不要包含'.dll'后缀，像<code>Main</code>、<code>Assembly-CSharp</code>这样即可。</p> <h3 id="differentialhybridassemblies"><a href="#differentialhybridassemblies" class="header-anchor">#</a> differentialHybridAssemblies</h3> <p><strong>注意！1.1.7版本移除了此字段。</strong></p> <p>差分混合执行的assembly列表。差分混合执行的assembly与纯热更新的assembly不是同一类assembly，不能同时出现在hotUpdateAssemblies列表中。</p> <h3 id="differentialhybridoptionoutputdir"><a href="#differentialhybridoptionoutputdir" class="header-anchor">#</a> differentialHybridOptionOutputDir</h3> <p><strong>注意！1.1.7版本移除了此字段。</strong></p> <p>差分混合执行的assembly的运行时配置参数。</p> <p>需要向差分混合执行的assembly传递一些配置参数，比如说哪些函数发生变化了。这些配置数据是 <code>LoadImageErrorCode RuntimeApi::LoadDifferentialHybridAssembly(byte[] dllBytes, byte[] optionBytes)</code> 的optionBytes参数.</p> <h3 id="collectassetreferencetypes"><a href="#collectassetreferencetypes" class="header-anchor">#</a> collectAssetReferenceTypes</h3> <p>收集资源中引用的脚本类型，加入到 <code>HybridCLR/Generate/LinkXml</code> 的保留集。</p> <h3 id="outputlinkfile"><a href="#outputlinkfile" class="header-anchor">#</a> outputLinkFile</h3> <p>运行菜单<code>HybridCLR/Generate/LinkXml</code>命令时，输出的link.xml文件路径。</p> <p>千万不要指向 <code>Assets/link.xml</code>，那个link.xml一般用来手动预留AOT类型，而这个自动输出的link.xml每次都会覆盖。</p> <h3 id="outputaotgenericreferencefile"><a href="#outputaotgenericreferencefile" class="header-anchor">#</a> outputAOTGenericReferenceFile</h3> <p>运行菜单<code>HybridCLR/Generate/AOTGenericReference</code>时输出的AOT泛型实例化集合文件的路径。</p> <h3 id="maxgenericreferenceiteration"><a href="#maxgenericreferenceiteration" class="header-anchor">#</a> maxGenericReferenceIteration</h3> <p>运行菜单<code>HybridCLR/Generate/AOTGenericReference</code>时，生成工具递归分析AOT泛型实例化的迭代次数。</p> <p>因为泛型函数中可能会间接使用了新的泛型类和泛型函数，因此需要多轮迭代才能分析出所有的泛型实例化，<code>maxGenericReferenceIteration</code>参数用于控制迭代次数。这个参数一般10以内就够了，你通过观察日志
能看到几轮迭代后计算终止，如果迭代终止时还有大量泛型未计算迭代，可以适当增加这个值。</p> <p>为什么不反复迭代直至计算出所有泛型实例化呢？因为有可能出现永远无法计算完的情况。如下代码，AOT.Show()
由于递归泛型实例化，永远也无法计算完。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
    <span class="token keyword">struct</span> <span class="token class-name">AOT<span class="token punctuation">&lt;</span>A<span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">{</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AOT<span class="token punctuation">&lt;</span>AOT<span class="token punctuation">&lt;</span>A<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            a<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="maxmethodbridgegenericiteration"><a href="#maxmethodbridgegenericiteration" class="header-anchor">#</a> maxMethodBridgeGenericIteration</h3> <p>运行菜单<code>HybridCLR/Generate/MethodBridge</code>时，生成工具递归分析AOT泛型实例化的迭代次数。含义与<code>maxGenericReferenceIteration</code>相似。</p> <h2 id="editor相关工具"><a href="#editor相关工具" class="header-anchor">#</a> Editor相关工具</h2> <p>主要包含以下功能：</p> <ul><li>初始化HybridCLR</li> <li>检查和修复设置</li> <li>打包时自动排除热更新assembly</li> <li>打包时将热更新dll名添加到assembly列表</li> <li>备份裁剪后的AOT dll</li> <li>生成一些打包需要的文件和代码</li> <li>编译用于目标平台的热更新dll</li></ul> <h3 id="初始化hybridclr"><a href="#初始化hybridclr" class="header-anchor">#</a> 初始化HybridCLR</h3> <p>运行<code>HybridCLR/Installer...</code>菜单命令完成初始化操作。详细见上面的菜单命令介绍。</p> <h3 id="检查和修复设置"><a href="#检查和修复设置" class="header-anchor">#</a> 检查和修复设置</h3> <p>属于打包工作流的一部分，相关代码在 <code>Editor/BuildProcessors/CheckSettings.cs</code>中。</p> <p>包含以下操作：</p> <ul><li>根据是否开启HybridCLR，设置或者清除UNITY_IL2CPP_PATH环境变量。脚本中修改的UNITY_IL2CPP_PATH环境变量是本进程的环境变量，不用担心干扰了其他项目。</li> <li>如果检测到意外开启增量式GC，自动关闭这个选项。</li> <li>如果HybridCLRSettings里未设置任何热更新assembly，提示错误。</li></ul> <h3 id="打包时自动排除热更新assembly"><a href="#打包时自动排除热更新assembly" class="header-anchor">#</a> 打包时自动排除热更新assembly</h3> <p>属于打包工作流的一部分，相关代码在 <code>Editor/BuildProcessors/FilterHotFixAssemblies.cs</code>中。</p> <p>很显然，热更新assembly不应该被il2cpp处理并且编译到最终的包体里。我们处理了<code>IFilterBuildAssemblies</code>回调，
将热更新dll从build assemblies列表移除。</p> <p>脚本中会额外检查是否写错assembly名字，以及是否失误配置了重复的assembly。</p> <h3 id="打包时将热更新dll名添加到assembly列表"><a href="#打包时将热更新dll名添加到assembly列表" class="header-anchor">#</a> 打包时将热更新dll名添加到assembly列表</h3> <p>属于打包工作流的一部分，相关代码在 <code>Editor/BuildProcessors/PatchScriptingAssemblyList.cs</code>中。</p> <p>工具在打包时，会自动将热更新assembly的dll名加入assembly列表配置文件。</p> <p>热更新MonoBehaviour脚本所在的assembly的dll名必须添加到assembly列表配置文件，Unity的资源管理系统才能正确识别
和还原热更新脚本。更详细的原理介绍请看 <a href="/hybridclr/monobehaviour/">使用热更新MonoBehaviour</a> 。</p> <h3 id="备份裁剪后的aot-dll"><a href="#备份裁剪后的aot-dll" class="header-anchor">#</a> 备份裁剪后的AOT dll</h3> <p>属于打包工作流的一部分，相关代码在 <code>Editor/BuildProcessors/CopyStrippedAOTAssemblies.cs</code>中。</p> <p>当补充元数据模式为<code>HomologousImageMode::Consistent</code>时，需要使用打包时生成的裁剪后的AOT dll。因此会自动将打包过程中生成的裁剪后的AOT dll
复制到 <code>{project}/HybridCLRData/AssembliesPostIl2CppStrip/{platform}</code>目录，方便将来处理。</p> <p>当数据模式为<code>HomologousImageMode::SuperSet</code>时，可以直接使用原始的aot dll。这个优点是工作流上便利一些，不用每次打包后更新aot dll，缺点是多占了内存，同时大幅增加了裁剪dll的大小，请使用者自己权衡使用原始还是裁剪后的aot dll。</p> <p><code>补充元数据</code> 更详细的原理性文档请看 <a href="/hybridclr/aot_generic/">AOT泛型原理</a></p> <h3 id="生成一些打包需要的文件和代码"><a href="#生成一些打包需要的文件和代码" class="header-anchor">#</a> 生成一些打包需要的文件和代码</h3> <p>包含以下几个生成功能：</p> <ul><li>扫描生成link.xml</li> <li>生成桥接函数</li> <li>生成AOT泛型实例化代码</li> <li>生成ReversePInvokeCallback相关wrapper文件</li></ul> <p>菜单<code>HybridCLR/Generate/*</code>中包含了这些生成命令，请看上面的介绍文档。</p> <h2 id="iosbuild脚本"><a href="#iosbuild脚本" class="header-anchor">#</a> iOSBuild脚本</h2> <p>package中 <code>Editor/Data~/iOSBuild</code> 包含了编译iOS版本libil2cpp.a所需的脚本。在运行<code>HybridCLR/Installer...</code>菜单命令成功初始化HybridCLR后，会自动复制到<code>{project}/HybridCLRData/iOSBuild</code>目录。<strong>后续操作必须在<code>{project}/HybridCLRData/iOSBuild</code>目录进行</strong>。</p> <p>build libil2cpp.a的具体操作请看文档 <a href="/hybridclr/build_ios_libil2cpp/">iOS平台打包</a>。</p> <h2 id="runtime相关脚本"><a href="#runtime相关脚本" class="header-anchor">#</a> Runtime相关脚本</h2> <p>包含运行时用到的类。目前比较简单。</p> <h3 id="loadimageerrorcode"><a href="#loadimageerrorcode" class="header-anchor">#</a> LoadImageErrorCode</h3> <p>加载热更新dll的错误码。</p> <h3 id="元数据模式-homologousimagemode"><a href="#元数据模式-homologousimagemode" class="header-anchor">#</a> 元数据模式 HomologousImageMode</h3> <p>目前支持两种元数据模式：</p> <h4 id="homologousimagemode-consistent-模式"><a href="#homologousimagemode-consistent-模式" class="header-anchor">#</a> <code>HomologousImageMode::Consistent</code> 模式</h4> <p>即补充的dll与打包时裁剪后的dll精确一致。因此必须使用build过程中生成的裁剪后的dll，则不能直接复制原始dll。我们在<code>HybridCLR.BuildProcessors.CopyStrippedAOTAssemblies</code>里添加了处理代码，在打包时自动将这些裁剪后的dll复制到 <code>{project}/HybridCLRData/AssembliesPostIl2CppStrip/{target}</code> 目录。</p> <h4 id="homologousimagemode-superset-模式"><a href="#homologousimagemode-superset-模式" class="header-anchor">#</a> <code>HomologousImageMode::SuperSet</code> 模式</h4> <p>即补充的dll是打包时裁剪后的dll的超集，包含了裁剪dll的所有元数据。一个最简单易得的超集dll为原始aot dll，这也是推荐使用的超集dll。</p> <ul><li>原始UnityEngine相关AOT dll在Unity安装目录的PlayBackEngines子目录下</li> <li>原始的.net核心AOT dll如mscorlib.dll在Unity安装目录的 <code>unityaot{xxx}</code> 目录下。2019-2020统一为unityaot目录，2021起拆分成多个目录，如果打包android取unityaot-linux、如果打包iOS取unityaot-macos。</li> <li>插件的AOT dll为工程目录中的相应平台的原始dll。如果是源码形式，则为编译好的dll，取<code>HybridCLR/HotUpdateDlls/{platform}</code>目录下的相应dll即可</li></ul> <p>以Unity 2020.3.33版本Win下的Win64目标为例：</p> <ul><li>mscorlib.dll在 <code>{editor}/Editor/Data/MonoBleedingEdge/lib/mono/unityaot</code></li> <li>UnityEngine.CoreModule.dll 在 <code>{editor}/Editor/Data/Playbackengines/windowsstandalonesupport/Variations/il2cpp/Managed</code></li> <li>protobuf-net.dll 为你的工程中的原始<code>protobuf-net.dll</code></li> <li>你的AOT模块Main对应的AOT dll为 <code>HybridCLR/HotUpdateDlls/{platform}/Main.dll</code></li></ul> <p><code>SuerSet</code>模式也可以使用<code>Consistent</code>模式的裁减后的dll，因为自己显然包含自身的所有元数据。但<code>SuperSet</code>模式主要为了简化工作流，避免<code>Consistent</code>模式经常出现的<code>metadata not match</code>的问题，因此除非要极致优化内存，强烈推荐使用原始AOT dll。</p> <h3 id="runtimeapi"><a href="#runtimeapi" class="header-anchor">#</a> RuntimeApi</h3> <p>底层的操作HybridCLR的工具类。比较常用的有几个</p> <ul><li><code>LoadImageErrorCode LoadMetadataForAOTAssembly(byte[] dllBytes, HomologousImageMode mode)</code> 用于加载补充元数据assembly。</li> <li><code>LoadImageErrorCode LoadDifferentialHybridAssembly(byte[] dllBytes, byte[] optionBytes)</code> 加载差分混合执行assembly。<strong>DHE版本</strong>专有函数。</li></ul> <h3 id="unchangedattribute"><a href="#unchangedattribute" class="header-anchor">#</a> UnchangedAttribute</h3> <p><strong>DHE版本</strong>专有类型。</p> <p>对于 差分混合执行assembly，用于手动指定哪些函数是否发生变化。变化的函数以interpreter模式执行，未变化的以原生AOT方式执行。</p> <p>当前出于演示目的，未变化的函数需要手动标记，后面的正式版本会自动计算，基本用不上这个特性。</p> <h3 id="reversepinvokewrappergenerationattribute"><a href="#reversepinvokewrappergenerationattribute" class="header-anchor">#</a> ReversePInvokeWrapperGenerationAttribute</h3> <p>每个带 <code>[MonoPInvokeCallback]</code> 特性的函数都需要一个唯一对应的wrapper函数。这些wrapper函数必须是打包时预先生成，不可变化。
因此如果后续热更新新增了 带 <code>[MonoPInvokeCallback]</code> 特性的函数，则会发生wrapper函数不足的情况。</p> <p>ReversePInvokeWrapperGenerationAttribute 用于为当前添加了 <code>[MonoPInvokeCallback]</code> 特性的函数预留指定数量的wrapper函数。</p> <p>在如下示例中，为LuaFunction签名的函数预留了10个wrapper函数.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>    <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">LuaFunction</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> luaState<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonoPInvokeWrapperPreserves</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ReversePInvokeWrapperGeneration</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MonoPInvokeCallback</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">LuaFunction</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">LuaCallback</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> luaState<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MonoPInvokeCallback</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MonoPInvokeCallback</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Sum2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MonoPInvokeCallback</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Sum3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/05/04, 11:48:51</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/hybridclr/hotreload/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">热重载技术</div></a> <a href="/hybridclr/modify_unity_dll/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">修改Unity编辑器相关dll</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/hybridclr/hotreload/" class="prev">热重载技术</a></span> <span class="next"><a href="/hybridclr/modify_unity_dll/">修改Unity编辑器相关dll</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/hybridclr/project_settings/"><div>
            项目设置
            <!----></div></a> <span class="date">09-29</span></dt></dl><dl><dd>02</dd> <dt><a href="/hybridclr/load_assembly/"><div>
            加载和使用热更新代码
            <!----></div></a> <span class="date">09-29</span></dt></dl><dl><dd>03</dd> <dt><a href="/hybridclr/build_game/"><div>
            打包
            <!----></div></a> <span class="date">09-29</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:hybridclr@code-philosophy.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/focus-creative-games" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>focus-creative-games</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.12d5fdbe.js" defer></script><script src="/assets/js/2.0771a7ec.js" defer></script><script src="/assets/js/41.703948ac.js" defer></script><script src="/assets/js/3.8d0c7075.js" defer></script>
  </body>
</html>
