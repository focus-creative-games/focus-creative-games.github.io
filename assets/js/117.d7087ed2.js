(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{472:function(t,e,s){"use strict";s.r(e);var a=s(7),n=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"memory-related-principles"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#memory-related-principles"}},[t._v("#")]),t._v(" Memory-related principles")]),t._v(" "),e("p",[t._v("HybridCLR is implemented at the CLR level, so the hot update script, except that the execution code is executed in interpreted mode, is completely the same as the AOT part.")]),t._v(" "),e("h2",{attrs:{id:"object-memory-size"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#object-memory-size"}},[t._v("#")]),t._v(" object memory size")]),t._v(" "),e("p",[t._v("For value types, the object size is not simply the size occupied by all members, memory alignment must be considered. For reference types, there is an extra object header (16 bytes), and the memory alignment is 8 bytes. For array types, it is more complicated.")]),t._v(" "),e("h3",{attrs:{id:"primitive-type"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#primitive-type"}},[t._v("#")]),t._v(" primitive type")]),t._v(" "),e("p",[t._v("Such as byte, int. As we all know, byte occupies 1 byte, int occupies 4 bytes, and others are not described in detail.")]),t._v(" "),e("h3",{attrs:{id:"struct-value-type"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#struct-value-type"}},[t._v("#")]),t._v(" struct value type")]),t._v(" "),e("p",[t._v("In the case where Explicit Layout is not specified, the total size is calculated according to the field size and memory alignment rules, which is similar to the struct calculation rules of C++. I wonâ€™t elaborate here, just give an example.")]),t._v(" "),e("div",{staticClass:"language-csharp line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// V1 object size 1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")])]),t._v(" a1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// V2 object size 8")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V2")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")])]),t._v(" a1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" a2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// V3 object size 24")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("V3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" a1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" a2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")])]),t._v(" a3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")])]),t._v(" a4"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br")])]),e("h3",{attrs:{id:"class-type"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#class-type"}},[t._v("#")]),t._v(" class type")]),t._v(" "),e("p",[t._v("Similar to the value type, but with 16 bytes of object header, and enforces memory alignment to 8 bytes. Example:")]),t._v(" "),e("div",{staticClass:"language-csharp line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// C1 object size 24")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("C1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")])]),t._v(" a1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// C2 object size 24")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("C2")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")])]),t._v(" a1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" a2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// C3 object size 40")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("C3")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" a1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" a2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")])]),t._v(" a3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")])]),t._v(" a4"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br")])]),e("h2",{attrs:{id:"compared-with-the-object-memory-size-of-lua-and-ilruntime"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#compared-with-the-object-memory-size-of-lua-and-ilruntime"}},[t._v("#")]),t._v(" Compared with the object memory size of lua and ILRuntime")]),t._v(" "),e("p",[t._v("The calculation rules of lua are slightly complicated, see "),e("a",{attrs:{href:"https://www.linuxidc.com/Linux/2018-10/154971.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("third-party article"),e("OutboundLink")],1),t._v(". An empty table occupies 56 bytes, and each additional field occupies at least 32 bytes.")]),t._v(" "),e("p",[t._v("The type of ILRuntime is expressed in IlTypeInstance except enum. The empty type occupies 72 bytes, and each additional field uses at least 16 bytes. If the object contains reference type data, there will be at least 24 bytes more overall, and each additional object field will add 8 bytes.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("Xlua")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ILRuntime")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("HybridCLR")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("V1")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("88")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("88")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("1")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("V2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("120")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("104")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("8")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("V3")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("184")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("168")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("24")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("C1")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("88")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("88")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("24")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("C2")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("120")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("104")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("24")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("C3")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("184")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("168")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("40")])])])]),t._v(" "),e("h2",{attrs:{id:"gc-during-operation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gc-during-operation"}},[t._v("#")]),t._v(" GC during operation")]),t._v(" "),e("p",[t._v("HybridCLR is implemented strictly according to the specifications. Except that the additional CPU and memory will be consumed when the assembly is loaded and the function is transferred for the first time, the memory consumed at runtime is exactly the same as that of il2cpp.")]),t._v(" "),e("p",[t._v("So you don't have to ask questions such as whether "),e("code",[t._v("foreach loop will generate GC")]),t._v(". How many GCs are generated under il2cpp or mono, and the exact same GCs are also generated when interpreted and executed in HybridCLR.")])])}),[],!1,null,null,null);e.default=n.exports}}]);