(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{363:function(t,n,a){"use strict";a.r(n);var e=a(7),r=Object(e.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"代码裁剪问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码裁剪问题"}},[t._v("#")]),t._v(" 代码裁剪问题")]),t._v(" "),n("p",[t._v("Unity使用了"),n("a",{attrs:{href:"https://docs.unity3d.com/Manual/ManagedCodeStripping.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码裁剪"),n("OutboundLink")],1),t._v("技术来帮助减少il2cpp backend的包体大小。如果未做防裁剪处理，由于AOT主工程里的代码一般不多，大量的C#类型和函数被\n裁剪，导致热更新中调用这些被裁剪类或函数出现如下异常：")]),t._v(" "),n("div",{staticClass:"language-txt line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-txt"}},[n("code",[t._v("    // 类型缺失错误\n    Unity: TypeLoadException: Could not load type 'Xxx' from assembly 'yyy'\n\n    // 函数缺失错误\n    MissingMethodException: xxxx\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("h2",{attrs:{id:"解决办法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决办法"}},[t._v("#")]),t._v(" 解决办法")]),t._v(" "),n("p",[t._v("标准解决办法是，根据日志错误日志确定哪个类型或函数被裁减，然后在link.xml里保留这个类型或函数，或者\n在主工程里显式地加上对这些类或函数的调用。")]),t._v(" "),n("p",[t._v("如果不熟悉如何在link.xml保留这个类型或函数，请参阅"),n("a",{attrs:{href:"https://docs.unity3d.com/Manual/ManagedCodeStripping.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码裁剪"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v('但这种办法终究很麻烦，实际项目中有大量被裁剪的类型，你一遍遍地进行"打包-类型缺失-补充-打包"的操作，\n浪费了极多时间。 '),n("RouterLink",{attrs:{to:"/hybridclr/hybridclr_unity/"}},[t._v("hybridclr_unity package")]),t._v("提供了一个便捷的生成脚本，\n你运行菜单"),n("code",[t._v("HybridCLR/Generate/LinkXml")]),t._v("就能一键生成热更新工程里的所有AOT类型及函数引用。详细请看\nhybridclr_unity package的文档说明。")],1),t._v(" "),n("h2",{attrs:{id:"aot类型及函数预留"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#aot类型及函数预留"}},[t._v("#")]),t._v(" AOT类型及函数预留")]),t._v(" "),n("p",[t._v("hybridclr_unity的link生成脚本虽然可以智能地扫描出你当前引用的AOT类型，却不能预知你未来将来使用的\n类型。因此你仍然需要有规划地提前在 "),n("code",[t._v("Assets/link.xml")]),t._v("(注意！不是自动生成的那个link.xml)预留你将来\n可能用到的类型。切记不要疏漏，免得出现上线后某次更新使用的类型被裁剪的尴尬状况！")])])}),[],!1,null,null,null);n.default=r.exports}}]);